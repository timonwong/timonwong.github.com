<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Timon Wong&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/27eba4a33a317761c17d96f1f009ae49</icon>
  <subtitle>(â•¯Â°â–¡Â°ï¼‰â•¯ â”»â”â”»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://theo.im/"/>
  <updated>2017-10-15T04:41:19.000Z</updated>
  <id>http://theo.im/</id>
  
  <author>
    <name>Timon Wong</name>
    <email>timon86.wang@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è§£å†³ AWS ELB å¶å‘çš„ 502 Bad Gateway é”™è¯¯</title>
    <link href="http://theo.im/blog/2017/10/14/suspicious-502-error-from-elb/"/>
    <id>http://theo.im/blog/2017/10/14/suspicious-502-error-from-elb/</id>
    <published>2017-10-14T15:32:11.000Z</published>
    <updated>2017-10-15T04:41:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ä½¿ç”¨äº† <a href="https://github.com/prometheus/blackbox_exporter" target="_blank" rel="external">Prometheus</a> åšäº† HTTP åè®®çš„ç›‘æ§ä¹‹åï¼Œ<a href="https://github.com/prometheus/blackbox_exporter" target="_blank" rel="external">blackbox_exporter</a> å¶å°”ä¼šæŠ¥ä¸€äº› ProbeDown çš„æŠ¥è­¦ï¼Œç»è¿‡æ£€æŸ¥æ˜¯ 502 Bad Gateway é”™è¯¯ï¼Œä½†æ­¤æ—¶åç«¯æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯åœ¨ AWS ELB çš„ç›‘æ§æŒ‡æ ‡ä¸­ï¼Œçœ‹åˆ°äº† ELB HTTP 5xx ç›¸å…³é”™è¯¯ï¼Œå› æ­¤å›°æ‰°äº†ä¸€æ®µæ—¶é—´ã€‚</p><p>HTTP æ•°æ®æµå‘å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[Client] --- [ELB] --- [nginx] --- [App Servers]</div></pre></td></tr></table></figure><h2 id="æ’æŸ¥é—®é¢˜"><a href="#æ’æŸ¥é—®é¢˜" class="headerlink" title="æ’æŸ¥é—®é¢˜"></a>æ’æŸ¥é—®é¢˜</h2><a id="more"></a><p>æœ€å¼€å§‹æ˜¯æ€€ç–‘æ˜¯åç«¯é—®é¢˜ï¼Œä½†æ˜¯æŸ¥é˜…äº† nginx å’Œ App servers çš„æ—¥å¿—ï¼Œæ²¡æœ‰ä»»ä½•ç»“æœï¼Œåªæ˜¯åœ¨ ELB æ—¥å¿—é‡Œé¢æ‰¾åˆ°äº† 502 Bad Gateway çš„é”™è¯¯ä¿¡æ¯ã€‚æ— å¥ˆä¹‹ä¸‹ç”šè‡³æ€€ç–‘ nginx æ‰€åœ¨ EC2 instance æœ‰é—®é¢˜ï¼Œå› æ­¤æ±‚åŠ©äº† AWS æŠ€æœ¯æ”¯æŒã€‚æ ¹æ®å»ºè®®ï¼Œåœ¨ nginx è¿™ç«¯åšäº† tcpdump æŠ“åŒ…ï¼Œæœ€åç»ˆäºåœ¨ AWS æŠ€æœ¯æ”¯æŒçš„å¸®åŠ©ä¸‹ï¼Œå®šä½å¹¶è§£å†³äº†é—®é¢˜ ğŸ‰ã€‚</p><p>å…ˆè¡¥å……ä¸€ä¸ªçŸ¥è¯†ï¼šå¦‚æœåç«¯æ”¯æŒçš„è¯ï¼ŒELB ä¼šä½¿ç”¨ä¿æŒè¿æ¥ï¼ˆHTTP persistent/keep-alive connectionsï¼‰ã€‚æ¥çœ‹çœ‹è¿™ä¸€ä¸ªä¿æŒè¿æ¥çš„ TCP streamï¼š</p><p><img src="http://theo-im.qiniudn.com/images/2017-10-14-tcpdump.png" alt=""></p><p>å…¶ä¸­ï¼Œ<code>10.100.2.186</code> æ˜¯ ELB å†…éƒ¨ IPï¼Œ<code>10.100.250.22</code> æ˜¯ nginx æœåŠ¡å™¨å†…éƒ¨ IPã€‚è¿™æ ·ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>åœ¨ 76.69 ç§’æ—¶å€™ï¼Œè¿æ¥è¢«åˆ›å»ºï¼›</li><li>åœ¨ 181.69 ç§’çš„æ—¶å€™ï¼Œæ˜¯æœ€åä¸€æ¬¡æœ‰æ•ˆè¯·æ±‚ï¼›</li><li>åœ¨ 256.69 ç§’çš„æ—¶å€™ï¼ˆNo.7475ï¼‰ï¼Œè¯¥è¿æ¥è¢« nginx å…³é—­ï¼›</li><li>åœ¨ 256.69 ç§’çš„æ—¶å€™ï¼Œå‡ ä¹åœ¨åŒæ—¶è¿˜æœ‰ä¸€ä¸ª HTTP GET è¯·æ±‚ï¼ˆNo.7476ï¼‰ï¼›</li><li>ç”±äº nginx å·²ç»å…³é—­è¿æ¥äº†ï¼Œä¸Šé¢çš„è¿™ä¸ªè¯·æ±‚å½“ç„¶ä¼šæ”¶åˆ° TCP RSTï¼ŒELB æ— æ³•è®¿é—®åç«¯æœåŠ¡å™¨ï¼Œå°±ä¼šè¿”å› 502 Bad Gateway äº†ã€‚</li></ul><p>åˆšåˆšè¿‡äº† 75 ç§’ï¼ˆ256.69 - 181.69ï¼‰è¿æ¥å°±è¢« nginx å…³é—­äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼šnginx <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_timeout" target="_blank" rel="external">keepalive_timeout</a> å‚æ•°çš„é»˜è®¤å€¼ï¼Œæ°å¥½å°±æ˜¯ 75 ç§’ã€‚</p><p>å¾ˆæ˜æ˜¾æ˜¯é‡åˆ°äº† Keep-Alive timeout race äº†ï¼Œè€Œè¿™ä¸ªé—®é¢˜å…¶å®åœ¨ HTTP/1.1 ä¸‹ï¼Œæ˜¯ä¸å¥½è§£å†³çš„ï¼Œåªæœ‰é å¾®è°ƒé™ä½å‡ºç°çš„æ¦‚ç‡ï¼›ç¦ç”¨ Keep-Aliveï¼›æˆ–è€…é  Client ä¸Šå±‚å¤„ç†ã€‚</p><h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><p>ç”±äº ELB å¹¶ä¸å—æˆ‘ä»¬çš„æ§åˆ¶ï¼Œæ‰€ä»¥è€ƒè™‘å¯¹åç«¯è¿›è¡Œå¾®è°ƒã€‚æ ¹æ®ä¸åŒçš„åœºæ™¯ï¼Œå¯ä»¥ï¼š</p><ul><li>å¢åŠ åç«¯æœåŠ¡å™¨æŒä¹…è¿æ¥çš„ä¿æŒæ—¶é—´ï¼Œæ¯”å¦‚ nginx å¢åŠ  <code>keepalive_timeout</code> å‚æ•°</li><li>ç¦ç”¨ HTTP æŒä¹…è¿æ¥ï¼‰</li></ul><p>æ ¹æ®<a href="https://blog.percy.io/tuning-nginx-behind-google-cloud-platform-http-s-load-balancer-305982ddb340" target="_blank" rel="external">è¿™ç¯‡è§£å†³ Google Cloud Platform è´Ÿè½½å‡è¡¡å™¨ç±»ä¼¼é—®é¢˜çš„æ–‡ç« </a>ï¼Œè¯´æ˜æˆ‘ä¸æ˜¯ä¸€ä¸ªäººğŸ˜‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;åœ¨ä½¿ç”¨äº† &lt;a href=&quot;https://github.com/prometheus/blackbox_exporter&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Prometheus&lt;/a&gt; åšäº† HTTP åè®®çš„ç›‘æ§ä¹‹åï¼Œ&lt;a href=&quot;https://github.com/prometheus/blackbox_exporter&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;blackbox_exporter&lt;/a&gt; å¶å°”ä¼šæŠ¥ä¸€äº› ProbeDown çš„æŠ¥è­¦ï¼Œç»è¿‡æ£€æŸ¥æ˜¯ 502 Bad Gateway é”™è¯¯ï¼Œä½†æ­¤æ—¶åç«¯æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯åœ¨ AWS ELB çš„ç›‘æ§æŒ‡æ ‡ä¸­ï¼Œçœ‹åˆ°äº† ELB HTTP 5xx ç›¸å…³é”™è¯¯ï¼Œå› æ­¤å›°æ‰°äº†ä¸€æ®µæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;HTTP æ•°æ®æµå‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[Client] --- [ELB] --- [nginx] --- [App Servers]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;æ’æŸ¥é—®é¢˜&quot;&gt;&lt;a href=&quot;#æ’æŸ¥é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;æ’æŸ¥é—®é¢˜&quot;&gt;&lt;/a&gt;æ’æŸ¥é—®é¢˜&lt;/h2&gt;
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="AWS" scheme="http://theo.im/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>è¯•ç”¨æœ€æ–°çš„ Docker for Mac Beta</title>
    <link href="http://theo.im/blog/2016/05/22/evaluating-new-docker-for-mac-beta/"/>
    <id>http://theo.im/blog/2016/05/22/evaluating-new-docker-for-mac-beta/</id>
    <published>2016-05-22T13:47:02.000Z</published>
    <updated>2017-10-15T04:24:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>DEPRECATION: ç°åœ¨ Docker for Mac å·²ç»å¯ä»¥é€šè¿‡ç•Œé¢é…ç½® mirror äº†ï¼Œè¿™ç‰‡æ–‡ç« ä½œåºŸ</p><a id="more"></a><h2 id="å¦‚ä½•ç”³è¯·-Docker-for-Mac-Beta"><a href="#å¦‚ä½•ç”³è¯·-Docker-for-Mac-Beta" class="headerlink" title="å¦‚ä½•ç”³è¯· Docker for Mac Beta"></a>å¦‚ä½•ç”³è¯· Docker for Mac Beta</h2><p>è¯·è®¿é—®è¿™ä¸ªåœ°å€ç”³è¯·ï¼Œå¯èƒ½éœ€è¦ç­‰å‡ å¤©ï¼š<a href="https://beta.docker.com/" target="_blank" rel="external">https://beta.docker.com/</a></p><p>Docker for Mac Betaï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯ä¸å†ä¾èµ– VirtualBox VM äº†ï¼Œè€Œæ˜¯ä½¿ç”¨äº†æ›´è½»é‡åŒ–çš„ <a href="https://github.com/mist64/xhyve" target="_blank" rel="external">xhyve</a> ä½œä¸ºå…¶è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼ˆä¹Ÿå³æ˜¯è¯´ï¼Œä»ç„¶ä¸æ˜¯åŸç”Ÿçš„ï¼Œè¿˜æ˜¯éœ€è¦è™šæ‹ŸåŒ–ä¸€ä¸ª Linux å‡ºæ¥åœ¨ä¸Šé¢è¿è¡Œ Docker Daemonï¼‰ã€‚</p><p>å¦å¤–ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ Docker for Mac ä½¿ç”¨äº† <a href="http://alpinelinux.org/" target="_blank" rel="external">Alpine Linux</a> å‘è¡Œç‰ˆï¼Œä½œä¸ºä¸€ä¸ªæ›´è½»é‡åŒ–çš„å‘è¡Œç‰ˆï¼Œä¸ä¸€èˆ¬çš„å‘è¡Œç‰ˆæœ‰ä¸å°‘åŒºåˆ«ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨ <code>ash</code> æ›¿æ¢ <code>bash</code> ç­‰ï¼Œå…·ä½“è¯·è®¿é—® <a href="http://alpinelinux.org/" target="_blank" rel="external">Alpine Linux</a> ç½‘ç«™è·å–æ›´å¤šä¿¡æ¯ã€‚</p><h2 id="ä½¿ç”¨-Docker-Hub-Registry-Mirror"><a href="#ä½¿ç”¨-Docker-Hub-Registry-Mirror" class="headerlink" title="ä½¿ç”¨ Docker Hub Registry Mirror"></a>ä½¿ç”¨ Docker Hub Registry Mirror</h2><p>ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œåœ¨å›½å†…è®¿é—® Docker Hub çš„é€Ÿåº¦ç›¸å½“ç¼“æ…¢ï¼Œå› æ­¤éœ€è¦è®¾ç½®ä¸€ä¸ª Docker Registry Mirror æ¥åŠ é€Ÿï¼Œè¿™é‡Œä½¿ç”¨ <a href="https://servers.ustclug.org/2015/05/new-docker-hub-registry-mirror/" target="_blank" rel="external">USTC çš„ Docker Hub Mirror</a>ã€‚</p><p>å°±å¦‚åŒä¹‹å‰æ‰€è¯´ï¼Œ<a href="http://alpinelinux.org/" target="_blank" rel="external">Alpine Linux</a> å‘è¡Œç‰ˆä¸ä¸€èˆ¬å‘è¡Œç‰ˆæœ‰å·¨å¤§åŒºåˆ«ï¼Œå› æ­¤è°ƒæ•´ Docker Daemon çš„å¯åŠ¨å‚æ•°ä¹Ÿä¸å¤§ä¸€æ ·ğŸ˜‚</p><h3 id="Quick-Way"><a href="#Quick-Way" class="headerlink" title="Quick Way"></a>Quick Way</h3><p><strong>NOTE:</strong> å®‰è£…äº† <code>jq</code> å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¯ä»¥é€šè¿‡ <code>brew install jq</code> å®‰è£…ï¼‰ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œä¸€è¡Œå‘½ä»¤è¡Œæå®šï¼Œå¦åˆ™è¯·å‚é˜…ã€ŒSlow Wayã€ä¸€èŠ‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pinata get daemon | jq -cM <span class="string">'."registry-mirrors" = ["https://docker.mirrors.ustc.edu.cn"]'</span> | pinata <span class="built_in">set</span> daemon -</div></pre></td></tr></table></figure><h3 id="Slow-Way"><a href="#Slow-Way" class="headerlink" title="Slow Way"></a>Slow Way</h3><h4 id="1-å¯¼å‡ºå½“å‰çš„è®¾ç½®"><a href="#1-å¯¼å‡ºå½“å‰çš„è®¾ç½®" class="headerlink" title="1. å¯¼å‡ºå½“å‰çš„è®¾ç½®"></a>1. å¯¼å‡ºå½“å‰çš„è®¾ç½®</h4><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å½“å‰è®¾ç½®ä¿å­˜åˆ° <code>docker-config.json</code> æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pinata get daemon &gt; docker-config.json</div><div class="line"><span class="comment">## &gt;&gt; &#123;"storage-driver":"aufs","debug":true&#125;</span></div></pre></td></tr></table></figure><h4 id="2-ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘è®¾ç½®"><a href="#2-ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘è®¾ç½®" class="headerlink" title="2. ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘è®¾ç½®"></a>2. ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘è®¾ç½®</h4><p>ä½¿ç”¨ä»»ä½•ä¸€ç§æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ‰“å¼€ <code>docker-config.json</code> å¹¶æŒ‰ç…§ <code>JSON</code> æ ¼å¼ç¼–è¾‘ä¸ºä»¥ä¸‹å†…å®¹ï¼Œç„¶åä¿å­˜å¹¶é€€å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"storage-driver"</span>:<span class="string">"aufs"</span>,<span class="attr">"debug"</span>:<span class="literal">true</span>,<span class="attr">"registry-mirrors"</span>:[<span class="string">"https://docker.mirrors.ustc.edu.cn"</span>]&#125;</div></pre></td></tr></table></figure><h4 id="3-åŠ è½½æœ€æ–°è®¾ç½®"><a href="#3-åŠ è½½æœ€æ–°è®¾ç½®" class="headerlink" title="3. åŠ è½½æœ€æ–°è®¾ç½®"></a>3. åŠ è½½æœ€æ–°è®¾ç½®</h4><p>æœ€åï¼ŒåŠ è½½ <code>docker-config.json</code> ä¸­çš„è®¾ç½®å°±å¯ä»¥äº†ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pinata set daemon @docker-config.json</div></pre></td></tr></table></figure><h2 id="è·å–-Docker-Guest-çš„-IP-åœ°å€"><a href="#è·å–-Docker-Guest-çš„-IP-åœ°å€" class="headerlink" title="è·å– Docker Guest çš„ IP åœ°å€"></a>è·å– Docker Guest çš„ IP åœ°å€</h2><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¾—åˆ° Docker Guest çš„ IP åœ°å€ï¼Œå…¶å®ä¸å¤§æœ‰æ¯”è¾ƒå¿«æ·çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œå…ˆè¿è¡Œ <code>pinata get network</code>ï¼Œå±…ç„¶è¿”å›è¿™ä¸ªï¼Ÿï¼ŸWTFï¼Ÿï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hostnet</div></pre></td></tr></table></figure><p>ç„¶ååªæœ‰è¿è¡Œ <code>pinata list</code> äº†ï¼š</p><pre><code>These are advanced configuration settings to customise Docker.app on MacOSX.You can set them via pinata set &lt;key&gt; &lt;value&gt; &lt;options&gt;.ğŸ³  hostname = docker   Hostname of the virtual machine endpoint, where container ports will be   exposed if using nat networking. Access it via &apos;docker.local&apos;.ğŸ³  hypervisor = native (memory=2, ncpu=2)   The Docker.app includes embedded hypervisors that run the virtual machines   that power the containers. This setting allows you to control which the   default one used for Linux is. â–¸  native: a version of the xhyve hypervisor that uses the MacOSX              Hypervisor.framework to run container VMs. Parameters:              memory (VM memory in gigabytes), ncpu (vCPUs)ğŸ³  network = hostnet (docker-ipv4=192.168.65.2, host-ipv4=192.168.65.1)   Controls how local containers can access the external network via the   MacOS X host. This includes outbound traffic as well as publishing ports   for external access to the local containers. â–¸ hostnet: a mode that helps if you are using a VPN that restricts              connectivity. Activating this mode will proxy container network              packets via the Docker.app process as host socket traffic.              Parameters: docker-ipv4 (docker node), host-ipv4 (host node) â–¸     nat: a mode that uses the MacOS X vmnet.framework to route container              traffic to the host network via a NAT.ğŸ³  filesystem = osxfs   Controls the mode by which files from the MacOS X host and the container   filesystem are shared with each other. â–¸   osxfs: a FUSE-based filesystem that bidirectionally forwards OSX              filesystem events into the container.ğŸ³  native/port-forwarding = true   Expose container ports on the Mac, rather than the VM â–¸    true: Container ports will be exposed on the Mac â–¸   false: Container ports will be exposed on the VMğŸ³  daemon = run &apos;pinata get daemon&apos; or &apos;pinata set daemon [@file|-]&gt;   JSON configuration of the local Docker daemon. Configure any custom   options you need as documented in:   https://docs.docker.com/engine/reference/commandline/daemon/. Set it   directly, or a @file or - for stdin.</code></pre><p>å› æ­¤çœ‹èµ·æ¥ä½¿ç”¨ <code>pinata list | grep &#39;network =&#39;</code> æ‰æ˜¯åˆç†çš„æ–¹å¼ä¹‹ä¸€ï¼š</p><pre><code>*  network = hostnet (docker-ipv4=192.168.65.2, host-ipv4=192.168.65.1)</code></pre><p>ä»¥ä¸Š</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;DEPRECATION: ç°åœ¨ Docker for Mac å·²ç»å¯ä»¥é€šè¿‡ç•Œé¢é…ç½® mirror äº†ï¼Œè¿™ç‰‡æ–‡ç« ä½œåºŸ&lt;/p&gt;
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Docker" scheme="http://theo.im/tags/docker/"/>
    
      <category term="OSX" scheme="http://theo.im/tags/osx/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Python ä¸­ç»Ÿè®¡æ–‡æœ¬å­—ç¬¦ä¸ªæ•°</title>
    <link href="http://theo.im/blog/2014/08/13/count-text-element-count-in-python/"/>
    <id>http://theo.im/blog/2014/08/13/count-text-element-count-in-python/</id>
    <published>2014-08-13T06:05:02.000Z</published>
    <updated>2016-05-22T13:48:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>å­—ç¬¦é›†å‘æ¥éƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå³ä½¿æ˜¯ Python 3.xï¼Œä¹Ÿæœ€å¤šåªæ˜¯èƒ½è¯´æ„Ÿè°¢ <a href="http://en.wikipedia.org/wiki/Unicode" target="_blank" rel="external">Unicode</a> å­—ç¬¦é›†ï¼Œå­—ç¬¦ä¸²çš„å­˜å–ç°åœ¨æ²¡æœ‰é—®é¢˜äº†ã€‚</p><p>Unicode å­—ç¬¦é›†çš„å¸¸è§<strong>ç¼–ç </strong>æœ‰ <a href="http://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="external">UTF-8</a>ã€<a href="http://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="external">UTF-16</a>ã€<a href="http://en.wikipedia.org/wiki/UTF-32" target="_blank" rel="external">UTF-32</a> ç­‰å¸¸è§æ ¼å¼ï¼Œå¦å¤–ï¼Œ<a href="http://en.wikipedia.org/wiki/GB_18030" target="_blank" rel="external">GB18030</a> ä¹Ÿå¯ä»¥ç®—å…¶ä¸­ä¸€ç§ï¼ˆ GB18030ï¼Œä¸ UTF-8 ç±»ä¼¼ï¼Œæ˜¯ä¸€ç§å˜é•¿ç¼–ç æ ¼å¼ï¼Œæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å…¼å®¹ <a href="http://en.wikipedia.org/wiki/GBK" target="_blank" rel="external">GBK</a>/<a href="http://en.wikipedia.org/wiki/GB2312" target="_blank" rel="external">GB2312</a> ï¼‰</p><p>ä½†æ˜¯ Unicode å°±èƒ½æ— ç—›çš„è§£å†³æ‰€æœ‰é—®é¢˜å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><a id="more"></a><h3 id="åæ§½åæ§½åæ§½"><a href="#åæ§½åæ§½åæ§½" class="headerlink" title="åæ§½åæ§½åæ§½"></a>åæ§½åæ§½åæ§½</h3><p>é¢˜å¤–è¯ï¼Œå¯¹äºä¼ ç»Ÿçš„ MBCS ç¼–ç ï¼Œæ€»å¾—è¯´æ¥ GBK è®¾è®¡ç®—æ˜¯æ¯”è¾ƒåˆç†çš„ï¼Œè‡³å°‘åœ¨ 0x00 ~ 0x7f çš„ ASCII åŒºé—´é‡Œé¢æ²¡æœ‰ä¹±æ¥ã€‚BIG5 å°±ä¸è¯´äº†ï¼Œâ€œè®¸åŠŸç›–â€ é—®é¢˜å¤§å®¶éƒ½çŸ¥é“ï¼Œç®€ç›´é¬¼ç«å†’ã€‚è¿™é‡Œå°±æ¥åæ§½ä¸€ä¸‹ Shift-JIS å’Œ EUC-KRï¼š</p><p><strong>Shift-JIS:</strong></p><table><thead><tr><th style="text-align:center">First byte</th><th style="text-align:center">ASCII</th><th style="text-align:center">Shift JIS</th></tr></thead><tbody><tr><td style="text-align:center">0x5c</td><td style="text-align:center"><code>\</code></td><td style="text-align:center"><code>Â¥</code></td></tr><tr><td style="text-align:center">0x7e</td><td style="text-align:center"><code>~</code></td><td style="text-align:center"><code>â€¾</code></td></tr></tbody></table><p><strong>EUC-KR:</strong></p><table><thead><tr><th style="text-align:center">First byte</th><th style="text-align:center">ASCII</th><th style="text-align:center">EUC-KR</th></tr></thead><tbody><tr><td style="text-align:center">0x5c</td><td style="text-align:center"><code>\</code></td><td style="text-align:center"><code>â‚©</code></td></tr></tbody></table><p>æ»¡çœ¼éƒ½æ˜¯é’±é’±é’±ï¼Œå‘µå‘µï¼Œæ‰“ä½ã€‚</p><h3 id="æ­£æ–‡æ­£æ–‡æ­£æ–‡"><a href="#æ­£æ–‡æ­£æ–‡æ­£æ–‡" class="headerlink" title="æ­£æ–‡æ­£æ–‡æ­£æ–‡"></a>æ­£æ–‡æ­£æ–‡æ­£æ–‡</h3><p>å…¶å®ƒçš„å…ˆæš‚ä¸”ä¸æï¼Œå°±è¯´æ€ä¹ˆç»Ÿè®¡å­—ç¬¦ä¸ªæ•°å§ï¼ˆæ–‡æœ¬å…ƒç´ ä¸ªæ•°ï¼‰ã€‚åœ¨ Python ä¸­ï¼Œå¾€å¾€æƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨ <code>len()</code> å‡½æ•°äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s = <span class="string">'ä¸­æ–‡'</span></div><div class="line">len(s) <span class="comment"># å‘µå‘µ...</span></div></pre></td></tr></table></figure><p>æ˜æ™ºçš„äººç±»çŸ¥é“æœ‰ Unicodeï¼Œå°±å¯ä»¥æŠŠ Unicode æ¬å‡ºæ¥äº†ï¼Œå“ªæ€•è¿™ä¸ªé—®é¢˜å…¶å®è·Ÿç¼–ç æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼š</p><blockquote><p>ç”¨ Unicode å°±å¥½äº†ï¼Œè¦ä¸å°±ä½¿ç”¨ Python 3 å­—ç¬¦ä¸²åŸç”Ÿä½¿ç”¨ Unicodeï¼Œæ— ç—›è§£å†³æ‰€æœ‰é—®é¢˜</p></blockquote><p>Coooooooooooooolï¼Œè®©æˆ‘ä»¬æ¥è¯•è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line">s1 = <span class="string">u'ä¸­æ–‡'</span></div><div class="line"><span class="keyword">assert</span> len(s1) == <span class="number">2</span>  <span class="comment"># Wow, çœ‹èµ·æ¥å¯¹äº†æ˜¯å§ï¼Œè®©æˆ‘ä»¬å¼¹å† ç›¸åº†å§</span></div><div class="line"></div><div class="line">s2 = <span class="string">u'ğ¤´ğªš¥'</span></div><div class="line">len(s2) <span class="comment"># å‘µå‘µå‘µ...</span></div></pre></td></tr></table></figure><p>å¤©æ‰çš„äººç±»çŸ¥é“ UCS-2 å’Œ UCS-4 çš„åŒºåˆ«ï¼š</p><blockquote><p>è°å«ä½ ç”¨ Windows å‘¢ï¼Œåªèƒ½ç”¨ UTF-16ï¼Œå¼±çˆ†äº†ï¼Œ Linux ä¸‹ç”¨ UCS-4 å°±èƒ½è§£å†³é—®é¢˜äº†</p></blockquote><p>Sure? ä¸¾ä¸€ä¸ªåä¾‹å°±å¯ä»¥äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="keyword">assert</span> sys.maxunicode == <span class="number">0x10ffff</span>  <span class="comment"># ä¿è¯æ˜¯é€šè¿‡ UCS-4 ç¼–è¯‘çš„</span></div><div class="line"></div><div class="line"><span class="comment"># è¿™æ ·ï¼Œå¸¸è§å­—ï¼Œæ²¡æœ‰é—®é¢˜ï¼ŒGOOD</span></div><div class="line"><span class="keyword">assert</span> len(<span class="string">u'ä¸­æ–‡'</span>) == <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># è¿™æ ·ï¼Œç”Ÿåƒ»å­—ï¼ŒNon BMPï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜, GOOD</span></div><div class="line"><span class="keyword">assert</span> len(<span class="string">u'ğ¤´ğªš¥'</span>) == <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># æ¬¢è¿æ¥åˆ° Unicode çš„ä¸–ç•Œ, ä¸è¦å¿˜äº† Unicode æœ‰å« Mark çš„è¿™ç§ä¸œè¥¿</span></div><div class="line"><span class="keyword">assert</span> len(<span class="string">u'Ã«Ì'</span>) == <span class="number">2</span></div></pre></td></tr></table></figure><p><img src="http://theo-im.qiniudn.com/images/yaoming-face.jpg" alt=""></p><p>æ‰€ä»¥æœ€æ€•åŠç½æ°´äº†ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘è‡ªå·±ï¼Œå¤ªå¯æ€•äº†ï¼‰ã€‚</p><h3 id="Show-Me-The-Source-Code"><a href="#Show-Me-The-Source-Code" class="headerlink" title="Show Me The Source Code"></a>Show Me The Source Code</h3><p>åœ¨ .Net Framwork é‡Œï¼Œæœ‰ä¸€ä¸ªå« String.Globalization.StringInfo çš„ç±»å¯ä»¥å¤„ç†ä¸Šé¢çš„æƒ…å†µã€‚ç”±äºæˆ‘æœ¬äººæ¯”è¾ƒæ‡’ï¼Œå°±ç›´æ¥å‚è€ƒ Mono çš„ä»£ç å†™äº†ï¼ŒMono çš„ä»£ç å¯ä»¥<a href="https://github.com/mono/mono/blob/master/mcs/class/corlib/System.Globalization/StringInfo.cs" target="_blank" rel="external">ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a>ã€‚</p><p>ä¸ºäº†é¿å…ç³»ç»Ÿçš„ç¼–ç é—®é¢˜ï¼Œæ¨èä¿å­˜ä¸ºæ–‡ä»¶(â€˜stringinfo.pyâ€™)ï¼Œå†ä½¿ç”¨ Python è§£æå™¨æ‰§è¡Œï¼š</p><figure class="highlight python"><figcaption><span>stringinfo.py</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> unicodedata</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">__all__ = [<span class="string">'UnicodeCategory'</span>, <span class="string">'StringInfo'</span>]</div><div class="line"></div><div class="line">PY3K = sys.version_info[<span class="number">0</span>] &gt;= <span class="number">3</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> PY3K:</div><div class="line">    unicode_type = str</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    unicode_type = unicode</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnicodeCategory</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="string">"""General Category for Unicode</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">    http://www.unicode.org/versions/Unicode6.0.0/ch04.pdf</span></div><div class="line"><span class="string">    """</span></div><div class="line"></div><div class="line">    <span class="comment"># Letter</span></div><div class="line">    UppercaseLetter = <span class="string">'Lu'</span></div><div class="line">    LowercaseLetter = <span class="string">'Ll'</span></div><div class="line">    TitlecaseLetter = <span class="string">'Lt'</span></div><div class="line">    ModifierLetter = <span class="string">'Lm'</span></div><div class="line">    OtherLetter = <span class="string">'Lo'</span></div><div class="line">    <span class="comment"># Mark</span></div><div class="line">    NonSpacingMark = <span class="string">'Mn'</span></div><div class="line">    SpacingCombiningMark = <span class="string">'Mc'</span></div><div class="line">    EnclosingMark = <span class="string">'Me'</span></div><div class="line">    <span class="comment"># Number</span></div><div class="line">    DecimalDigitNumber = <span class="string">'Nd'</span></div><div class="line">    LetterNumber = <span class="string">'Nl'</span></div><div class="line">    OtherNumber = <span class="string">'No'</span></div><div class="line">    <span class="comment"># Separator</span></div><div class="line">    SpaceSeparator = <span class="string">'Zs'</span></div><div class="line">    LineSeparator = <span class="string">'Zl'</span></div><div class="line">    ParagraphSeparator = <span class="string">'Zp'</span></div><div class="line">    <span class="comment"># Punctuation</span></div><div class="line">    ConnectorPunctuation = <span class="string">'Pc'</span></div><div class="line">    DashPunctuation = <span class="string">'Pd'</span></div><div class="line">    OpenPunctuation = <span class="string">'Ps'</span></div><div class="line">    ClosePunctuation = <span class="string">'Pe'</span></div><div class="line">    InitialQuotePunctuation = <span class="string">'Pi'</span></div><div class="line">    FinalQuotePunctuation = <span class="string">'Pf'</span></div><div class="line">    OtherPunctuation = <span class="string">'Po'</span></div><div class="line">    <span class="comment"># Symbol</span></div><div class="line">    MathSymbol = <span class="string">'Sm'</span></div><div class="line">    CurrencySymbol = <span class="string">'Sc'</span></div><div class="line">    ModifierSymbol = <span class="string">'Sk'</span></div><div class="line">    OtherSymbol = <span class="string">'So'</span></div><div class="line">    <span class="comment"># Other</span></div><div class="line">    Control = <span class="string">'Cc'</span></div><div class="line">    Format = <span class="string">'Cf'</span></div><div class="line">    Surrogate = <span class="string">'Cs'</span></div><div class="line">    PrivateUse = <span class="string">'Co'</span></div><div class="line">    OtherNotAssigned = <span class="string">'Cn'</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringInfo</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, s)</span>:</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(s, unicode_type):</div><div class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"'string' parameter must be unicode"</span>)</div><div class="line">        self.s = s</div><div class="line"></div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">length_in_text_elements</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""Gets the number of text elements."""</span></div><div class="line">        l = getattr(self, <span class="string">'_length_in_text_elements'</span>, <span class="keyword">None</span>)</div><div class="line">        <span class="keyword">if</span> l <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            l = sum(<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> self.text_element_length_generator(self.s))</div><div class="line">            setattr(self, <span class="string">'_length_in_text_elements'</span>, l)</div><div class="line">        <span class="keyword">return</span> l</div><div class="line"></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_element_length_generator</span><span class="params">(cls, s)</span>:</span></div><div class="line">        <span class="string">"""Gets the text element index generator of the specified string."""</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(s, unicode_type):</div><div class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"parameter 's' must be unicode"</span>)</div><div class="line"></div><div class="line">        marks = set([UnicodeCategory.NonSpacingMark,</div><div class="line">                     UnicodeCategory.SpacingCombiningMark,</div><div class="line">                     UnicodeCategory.EnclosingMark])</div><div class="line"></div><div class="line">        idx = <span class="number">0</span></div><div class="line">        <span class="keyword">while</span> idx &lt; len(s):</div><div class="line">            ch = s[idx]</div><div class="line">            count = <span class="number">1</span></div><div class="line">            cat = unicodedata.category(ch)</div><div class="line"></div><div class="line">            <span class="keyword">if</span> cat == UnicodeCategory.Surrogate:</div><div class="line">                <span class="comment"># Check that it's a high surrogate followed by a low surrogate</span></div><div class="line">                <span class="keyword">if</span> <span class="number">0xd800</span> &lt;= ord(ch) &lt;= <span class="number">0xdbff</span>:</div><div class="line">                    <span class="keyword">if</span> (idx + <span class="number">1</span>) &lt; len(s) <span class="keyword">and</span> \</div><div class="line">                            <span class="number">0xdc00</span> &lt;= ord(s[idx + <span class="number">1</span>]) &lt;= <span class="number">0xdfff</span>:</div><div class="line">                        <span class="comment"># A valid surrogate pair</span></div><div class="line">                        count = <span class="number">2</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="comment"># Look for a base character, which may or may not be followed by a</span></div><div class="line">                <span class="comment"># series of combining characters</span></div><div class="line">                <span class="keyword">if</span> cat <span class="keyword">not</span> <span class="keyword">in</span> marks:</div><div class="line">                    <span class="keyword">while</span> idx + count &lt; len(s):</div><div class="line">                        cat = unicodedata.category(s[idx + count])</div><div class="line">                        <span class="keyword">if</span> cat <span class="keyword">not</span> <span class="keyword">in</span> marks:</div><div class="line">                            <span class="comment"># Finished the sequence</span></div><div class="line">                            <span class="keyword">break</span></div><div class="line">                        count += <span class="number">1</span></div><div class="line">            <span class="keyword">yield</span> count</div><div class="line">            idx += count</div><div class="line"></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">text_element_generator</span><span class="params">(cls, s)</span>:</span></div><div class="line">        <span class="string">"""Gets the text element generator of the specified string."""</span></div><div class="line">        idx = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> length <span class="keyword">in</span> cls.text_element_length_generator(s):</div><div class="line">            <span class="keyword">yield</span> s[idx:idx+length]</div><div class="line">            idx += length</div></pre></td></tr></table></figure><p>ç„¶åç®€å•æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div><div class="line"></div><div class="line"><span class="keyword">import</span> unicodedata</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="keyword">from</span> stringinfo <span class="keyword">import</span> StringInfo</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> sys.maxunicode &gt; <span class="number">0xffff</span>:</div><div class="line">        print(<span class="string">"Unicode encoding is UTF-32"</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        print(<span class="string">"Unicode encoding is UTF-16"</span>)</div><div class="line"></div><div class="line">    s = <span class="string">u"Ã«Ìä¸­æ–‡ğ¤´ğªš¥"</span></div><div class="line">    print(len(s))  <span class="comment"># æ ¹æ® Python æ˜¯å¦å¯ç”¨ UCS-4ï¼Œç»“æœä¸åŒï¼ŒUTF-16 ä¸‹æ˜¯ 8ï¼ŒUCS-4 ä¸‹æ˜¯ 6</span></div><div class="line">    print(StringInfo(s).length_in_text_elements)  <span class="comment"># 5ä¸ªå­—ç¬¦</span></div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</div><div class="line">        print(<span class="string">'U+&#123;:04X&#125;:&#123;&#125;'</span>.format(ord(c), unicodedata.category(c)))</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure><p>â•®(â•¯_â•°)â•­ ç»ˆäºèˆ’æœäº†ã€‚</p><p>~FIN~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å­—ç¬¦é›†å‘æ¥éƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå³ä½¿æ˜¯ Python 3.xï¼Œä¹Ÿæœ€å¤šåªæ˜¯èƒ½è¯´æ„Ÿè°¢ &lt;a href=&quot;http://en.wikipedia.org/wiki/Unicode&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Unicode&lt;/a&gt; å­—ç¬¦é›†ï¼Œå­—ç¬¦ä¸²çš„å­˜å–ç°åœ¨æ²¡æœ‰é—®é¢˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;Unicode å­—ç¬¦é›†çš„å¸¸è§&lt;strong&gt;ç¼–ç &lt;/strong&gt;æœ‰ &lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-8&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UTF-8&lt;/a&gt;ã€&lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-16&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UTF-16&lt;/a&gt;ã€&lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-32&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;UTF-32&lt;/a&gt; ç­‰å¸¸è§æ ¼å¼ï¼Œå¦å¤–ï¼Œ&lt;a href=&quot;http://en.wikipedia.org/wiki/GB_18030&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GB18030&lt;/a&gt; ä¹Ÿå¯ä»¥ç®—å…¶ä¸­ä¸€ç§ï¼ˆ GB18030ï¼Œä¸ UTF-8 ç±»ä¼¼ï¼Œæ˜¯ä¸€ç§å˜é•¿ç¼–ç æ ¼å¼ï¼Œæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å…¼å®¹ &lt;a href=&quot;http://en.wikipedia.org/wiki/GBK&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GBK&lt;/a&gt;/&lt;a href=&quot;http://en.wikipedia.org/wiki/GB2312&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GB2312&lt;/a&gt; ï¼‰&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ Unicode å°±èƒ½æ— ç—›çš„è§£å†³æ‰€æœ‰é—®é¢˜å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Python" scheme="http://theo.im/tags/python/"/>
    
      <category term="Unicode" scheme="http://theo.im/tags/unicode/"/>
    
  </entry>
  
  <entry>
    <title>Golang å†…å­˜æ¨¡å‹ï¼ˆä¸€ï¼‰</title>
    <link href="http://theo.im/blog/2014/08/08/Golang-memory-part-1/"/>
    <id>http://theo.im/blog/2014/08/08/Golang-memory-part-1/</id>
    <published>2014-08-08T00:39:44.000Z</published>
    <updated>2016-05-22T13:48:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ç¯‡èœBå†™çš„æ–‡ç« ï¼Œå¯èƒ½ä¼šæœ‰ç†è§£é”™è¯¯çš„åœ°æ–¹ï¼Œå‘ç°é”™è¯¯è¯·æ–§æ­£ï¼Œè°¢è°¢ã€‚</p><p>ä¸ºäº†æ²»ç–—æˆ‘çš„æ‡’ç™Œæ—©æœŸï¼Œæˆ‘ä¸€æ¬¡å°±ä¸å†™å¾—å¤ªå¤šäº†ï¼Œè¿™ä¸ªç³»åˆ—æƒ³å†™å¾ˆä¹…äº†ï¼Œæ¯æ¬¡éƒ½æ˜¯å¼€äº†ä¸ªå¤´å°±æ²¡æœ‰å†å†™ã€‚è¿™æ¬¡äº‰å–æŠŠå†™å®Œï¼Œå¼„æˆä¸€ä¸ªç³»åˆ—ã€‚</p><h2 id="æ­¤-nil-ä¸ç­‰å½¼-nil"><a href="#æ­¤-nil-ä¸ç­‰å½¼-nil" class="headerlink" title="æ­¤ nil ä¸ç­‰å½¼ nil"></a>æ­¤ nil ä¸ç­‰å½¼ nil</h2><p><em>å…ˆå£°æ˜ï¼Œè¿™ä¸ªæ ‡é¢˜æœ‰æ ‡é¢˜å…šçš„å«Œç–‘ã€‚</em></p><p>Go çš„ç±»å‹ç³»ç»Ÿæ˜¯æ¯”è¾ƒå¥‡è‘©çš„ï¼Œ<code>nil</code> çš„å«ä¹‰è·Ÿå…¶å®ƒè¯­è¨€æœ‰äº›å·®åˆ«ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼ˆå¯ä»¥ç›´æ¥è¿›å…¥ <a href="http://play.golang.org/p/ezFhXX0dnB" target="_blank" rel="external">http://play.golang.org/p/ezFhXX0dnB</a> è¿è¡ŒæŸ¥çœ‹ç»“æœï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> a *A = <span class="literal">nil</span></div><div class="line">    <span class="keyword">var</span> ai <span class="keyword">interface</span>&#123;&#125; = a</div><div class="line">    <span class="keyword">var</span> ei <span class="keyword">interface</span>&#123;&#125; = <span class="literal">nil</span></div><div class="line"></div><div class="line">    fmt.Printf(<span class="string">"ai == nil: %v\n"</span>, ai == <span class="literal">nil</span>)</div><div class="line">    fmt.Printf(<span class="string">"ai == ei: %v\n"</span>, ai == ei)</div><div class="line">    fmt.Printf(<span class="string">"ei == a: %v\n"</span>, a == ei)</div><div class="line">    fmt.Printf(<span class="string">"ei == nil: %v\n"</span>, ei == <span class="literal">nil</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// -&gt; è¾“å‡º</span></div><div class="line"><span class="comment">// ai == nil: false</span></div><div class="line"><span class="comment">// ai == ei: false</span></div><div class="line"><span class="comment">// ei == a: false</span></div><div class="line"><span class="comment">// ei == nil: true</span></div></pre></td></tr></table></figure><p>è¿™é‡Œ <code>ai != nil</code>ï¼Œå¯¹äºæ²¡æœ‰ç”¨è¿‡ Go çš„äººæ¥è¯´æ¯”è¾ƒè´¹è§£ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªç®—å¾—ä¸Šä¸€é—¨è¯­è¨€è®¾è®¡æœ‰æ­§ä¹‰çš„åœ°æ–¹ï¼ˆGolang FAQ æœ‰å¯¹äºæ­¤é—®é¢˜çš„æè¿°ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š<a href="http://golang.org/doc/faq#nil_error" target="_blank" rel="external">http://golang.org/doc/faq#nil_error</a>ï¼‰ã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯ nil ä»£è¡¨ â€œzero valueâ€ï¼ˆç©ºå€¼ï¼‰ï¼Œ<strong>å¯¹äºä¸åŒç±»å‹ï¼Œå®ƒå…·ä½“æ‰€ä»£è¡¨çš„å€¼ä¸åŒ</strong>ã€‚æ¯”å¦‚ä¸Šé¢çš„ <code>a</code> ä¸ºâ€œ<code>*A</code> ç±»å‹çš„ç©ºå€¼â€ï¼Œè€Œ <code>ai</code> ä¸ºâ€œ<code>interface{}</code> ç±»å‹çš„ç©ºå€¼â€ã€‚é€ æˆç†è§£å¤±è¯¯çš„æœ€å¤§é—®é¢˜åœ¨äºï¼Œ<code>struct pointer</code> åˆ° <code>interface</code> æœ‰éšå¼è½¬æ¢ï¼ˆ<code>var ai interface{] = a</code>ï¼Œè¿™é‡Œæœ‰ä¸ªéšå¼è½¬æ¢ï¼‰ï¼Œè‡³äºä¸ºä»€ä¹ˆå¯¹äº Go è¿™ç§åœ¨å…¶å®ƒè½¬æ¢æ–¹é¢è¦æ±‚ä¸¥æ ¼ï¼Œè€Œå¯¹äº <code>interface</code> è¦é™¤å¤–å‘¢ï¼Œfor convenience å§ï¼Œå‘µå‘µâ€¦â€¦</p><p>ç¢°åˆ°äº†è¿™ä¸ªå‘ï¼Œæˆ‘å°±å¼€å§‹å¥½å¥‡äº†ï¼ŒGo çš„ç±»å‹ç³»ç»Ÿåˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</p><a id="more"></a><h2 id="Go-å†…å­˜æ¨¡å‹-interface"><a href="#Go-å†…å­˜æ¨¡å‹-interface" class="headerlink" title="Go å†…å­˜æ¨¡å‹ - interface"></a>Go å†…å­˜æ¨¡å‹ - interface</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>ä¸ºäº†è¯»æ‡‚ä¸‹é¢çš„å†…å®¹ï¼Œä½ éœ€è¦ï¼š</p><ul><li>äº†è§£ Cã€Go è¯­è¨€</li><li>Go 1.3 æºä»£ç  (<a href="https://go.googlecode.com/archive/go1.3.zip" target="_blank" rel="external">https://go.googlecode.com/archive/go1.3.zip</a>)</li></ul><p><strong>PS:</strong> ç”±äº Go ç”¨åˆ°äº† <code>Plan9 C</code> è¿™ä¸ªå°ä¼—çš„Cç¼–è¯‘å™¨çš„æ‰©å±•ï¼Œæ¯”å¦‚åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨ <code>Â·</code> å­—ç¬¦ä»¥åŒºåˆ† package/functionï¼ˆæ¯”å¦‚<code>runtimeÂ·panic</code>ï¼‰ï¼Œè¿™å¯¹ç†è§£ä¸ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ã€‚</p><p><strong>PSS:</strong> å¯¹äº Go runtimeï¼Œå¯ä»¥å‚è€ƒ<code>src/pkg/reflect</code>ï¼ˆ<code>reflect</code>åŒ…ï¼‰ä¸­çš„çš„ä»£ç ï¼Œå¯¹ç±»å‹ç³»ç»Ÿçš„å®ç°çš„ç†è§£æœ‰å¸®åŠ©ã€‚</p><p>Go è¯­è¨€çš„ç±»å‹å®šä¹‰å¯ä»¥åœ¨ <code>src/pkg/runtime/</code> ç›®å½•ä¸‹æ‰¾åˆ°ï¼Œä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶æ„æˆï¼š</p><ul><li><code>runtime.h</code></li><li><code>type.h</code></li></ul><p>å¯¹äº <code>interface</code> ç±»å‹ï¼Œä¸»è¦çœ‹ä¸‹é¢å‡ ä¸ªç»“æ„ä½“å®šä¹‰ï¼š</p><ul><li><code>InterfaceType</code></li><li><code>Itab</code></li><li><code>Iface</code></li><li><code>Eface</code></li></ul><p>å®ƒä»¬çš„Cè¯­è¨€å®šä¹‰å¦‚ä¸‹ (å¯ä»¥åœ¨ <code>runtime.h</code> ä¸­æ‰¾åˆ°)ï¼š</p><p><strong>InterfaceType:</strong></p><p>ä»£è¡¨äº†æ€»çš„ interface ç±»å‹ï¼Œå…¶ä¸­ï¼š</p><ul><li>Type: ç±»å‹æè¿°ï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½æœ‰è¿™ä¸ªç±»å‹æè¿°ï¼ˆæ¯”å¦‚ array, map, sliceï¼‰</li><li>mhdr ä»¥åŠ m: interface æ¥å£æ–¹æ³•åˆ—è¡¨</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> InterfaceType</div><div class="line">&#123;</div><div class="line">    Type;</div><div class="line">    Slice mhdr;</div><div class="line">    IMethod m[];</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p><strong>Itab:</strong></p><p>ç±»ä¼¼äºè™šå‡½æ•°è¡¨ï¼Œè¯¥è¡¨ä¸ä¼šè¢«GCå›æ”¶ï¼Œå…¶ä¸­ï¼š</p><ul><li>inter: æŒ‡å‘å…·ä½“çš„ interface ç±»å‹</li><li>type: å…·ä½“å®ç°ç±»å‹, ä¹Ÿå³ receiver type</li><li>link: æŒ‡å‘ä¸‹ä¸€ä¸ªå‡½æ•°è¡¨ï¼Œå› ä¸º interface å¯ä»¥ embed å¤šä¸ª interfaceï¼Œå› æ­¤å®ç°ä¸ºä¸€ä¸ªé“¾è¡¨å½¢å¼</li><li>bad: &lt;ç•¥&gt;</li><li>unsued: &lt;ç•¥&gt;</li><li>fun: å‡½æ•°åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘å…·ä½“å‡½æ•°å®ç°çš„æŒ‡é’ˆ</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span>  Itab</div><div class="line">&#123;</div><div class="line">    InterfaceType*  inter;</div><div class="line">    Type*   type;</div><div class="line">    Itab*   link;</div><div class="line">    int32   bad;</div><div class="line">    int32   unused;</div><div class="line">    <span class="keyword">void</span>    (*fun[])(<span class="keyword">void</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p><strong>Iface:</strong></p><p>è¯¥ç±»å‹ä¸ºä¸€èˆ¬çš„ <code>interface</code> ç±»å‹æ‰€å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­ï¼š</p><ul><li>tab: å‚è§ <code>Itab</code> çš„è¯´æ˜ï¼Œå°¤å…¶æ˜¯ <code>Itab::link</code></li><li>data: æŒ‡å‘å…·ä½“æ•°æ®ï¼ˆæ¯”å¦‚æŒ‡å‘structï¼Œå½“ç„¶ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ä¸è¶…è¿‡ä¸€ä¸ªå­—é•¿ï¼Œé‚£ä¹ˆè¿™ä¸ªdataå°±å¯ä»¥ç›´æ¥å­˜æ”¾ï¼Œä¸éœ€è¦æŒ‡é’ˆå†åšä»¥åŠè·³è½¬ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Iface</div><div class="line">&#123;</div><div class="line">    Itab*   tab;</div><div class="line">    <span class="keyword">void</span>*   data;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p><strong>Eface:</strong></p><p>è¯¥ç±»å‹ä¸º <code>interface{}</code> (empty interface) æ‰€å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­ï¼š</p><ul><li>type: å…·ä½“å®ç°ç±»å‹, ä¹Ÿå³ receiver type</li><li>data: åŒ <code>Iface</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> Eface</div><div class="line">&#123;</div><div class="line">    Type*   type;</div><div class="line">    <span class="keyword">void</span>*   data;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>ä»–ä»¬çš„ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://theo-im.qiniudn.com/images/graph/20140808-interface-deps.png" alt=""></p><p>å…ˆåˆ°è¿™é‡Œï¼Œä¸‹ä¸€ç¯‡å°†ä¼šä¸¾ä¾‹å­è¯´æ˜ç»™ä¸€ä¸ª <code>interface{}</code> ç±»å‹çš„å˜é‡èµ‹å€¼åï¼Œå…¶å…·ä½“çš„å†…å­˜ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p><p>æ‰“äº†å‡ ä¸ªå°æ—¶ï¼ŒçœŸè´¹æ—¶é—´ï¼Œäº‰å–è¿™ä¸ªç³»åˆ—ä¸å‘ (é€ƒ</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¼€å§‹ä¹‹å‰&quot;&gt;&lt;a href=&quot;#å¼€å§‹ä¹‹å‰&quot; class=&quot;headerlink&quot; title=&quot;å¼€å§‹ä¹‹å‰&quot;&gt;&lt;/a&gt;å¼€å§‹ä¹‹å‰&lt;/h2&gt;&lt;p&gt;é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ç¯‡èœBå†™çš„æ–‡ç« ï¼Œå¯èƒ½ä¼šæœ‰ç†è§£é”™è¯¯çš„åœ°æ–¹ï¼Œå‘ç°é”™è¯¯è¯·æ–§æ­£ï¼Œè°¢è°¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ²»ç–—æˆ‘çš„æ‡’ç™Œæ—©æœŸï¼Œæˆ‘ä¸€æ¬¡å°±ä¸å†™å¾—å¤ªå¤šäº†ï¼Œè¿™ä¸ªç³»åˆ—æƒ³å†™å¾ˆä¹…äº†ï¼Œæ¯æ¬¡éƒ½æ˜¯å¼€äº†ä¸ªå¤´å°±æ²¡æœ‰å†å†™ã€‚è¿™æ¬¡äº‰å–æŠŠå†™å®Œï¼Œå¼„æˆä¸€ä¸ªç³»åˆ—ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ­¤-nil-ä¸ç­‰å½¼-nil&quot;&gt;&lt;a href=&quot;#æ­¤-nil-ä¸ç­‰å½¼-nil&quot; class=&quot;headerlink&quot; title=&quot;æ­¤ nil ä¸ç­‰å½¼ nil&quot;&gt;&lt;/a&gt;æ­¤ nil ä¸ç­‰å½¼ nil&lt;/h2&gt;&lt;p&gt;&lt;em&gt;å…ˆå£°æ˜ï¼Œè¿™ä¸ªæ ‡é¢˜æœ‰æ ‡é¢˜å…šçš„å«Œç–‘ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Go çš„ç±»å‹ç³»ç»Ÿæ˜¯æ¯”è¾ƒå¥‡è‘©çš„ï¼Œ&lt;code&gt;nil&lt;/code&gt; çš„å«ä¹‰è·Ÿå…¶å®ƒè¯­è¨€æœ‰äº›å·®åˆ«ï¼Œè¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼ˆå¯ä»¥ç›´æ¥è¿›å…¥ &lt;a href=&quot;http://play.golang.org/p/ezFhXX0dnB&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://play.golang.org/p/ezFhXX0dnB&lt;/a&gt; è¿è¡ŒæŸ¥çœ‹ç»“æœï¼‰ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;package&lt;/span&gt; main&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt; A &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; a *A = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; ai &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt;&amp;#123;&amp;#125; = a&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; ei &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt;&amp;#123;&amp;#125; = &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fmt.Printf(&lt;span class=&quot;string&quot;&gt;&quot;ai == nil: %v\n&quot;&lt;/span&gt;, ai == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fmt.Printf(&lt;span class=&quot;string&quot;&gt;&quot;ai == ei: %v\n&quot;&lt;/span&gt;, ai == ei)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fmt.Printf(&lt;span class=&quot;string&quot;&gt;&quot;ei == a: %v\n&quot;&lt;/span&gt;, a == ei)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    fmt.Printf(&lt;span class=&quot;string&quot;&gt;&quot;ei == nil: %v\n&quot;&lt;/span&gt;, ei == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// -&amp;gt; è¾“å‡º&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ai == nil: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ai == ei: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ei == a: false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ei == nil: true&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;è¿™é‡Œ &lt;code&gt;ai != nil&lt;/code&gt;ï¼Œå¯¹äºæ²¡æœ‰ç”¨è¿‡ Go çš„äººæ¥è¯´æ¯”è¾ƒè´¹è§£ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªç®—å¾—ä¸Šä¸€é—¨è¯­è¨€è®¾è®¡æœ‰æ­§ä¹‰çš„åœ°æ–¹ï¼ˆGolang FAQ æœ‰å¯¹äºæ­¤é—®é¢˜çš„æè¿°ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š&lt;a href=&quot;http://golang.org/doc/faq#nil_error&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://golang.org/doc/faq#nil_error&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•çš„è¯´å°±æ˜¯ nil ä»£è¡¨ â€œzero valueâ€ï¼ˆç©ºå€¼ï¼‰ï¼Œ&lt;strong&gt;å¯¹äºä¸åŒç±»å‹ï¼Œå®ƒå…·ä½“æ‰€ä»£è¡¨çš„å€¼ä¸åŒ&lt;/strong&gt;ã€‚æ¯”å¦‚ä¸Šé¢çš„ &lt;code&gt;a&lt;/code&gt; ä¸ºâ€œ&lt;code&gt;*A&lt;/code&gt; ç±»å‹çš„ç©ºå€¼â€ï¼Œè€Œ &lt;code&gt;ai&lt;/code&gt; ä¸ºâ€œ&lt;code&gt;interface{}&lt;/code&gt; ç±»å‹çš„ç©ºå€¼â€ã€‚é€ æˆç†è§£å¤±è¯¯çš„æœ€å¤§é—®é¢˜åœ¨äºï¼Œ&lt;code&gt;struct pointer&lt;/code&gt; åˆ° &lt;code&gt;interface&lt;/code&gt; æœ‰éšå¼è½¬æ¢ï¼ˆ&lt;code&gt;var ai interface{] = a&lt;/code&gt;ï¼Œè¿™é‡Œæœ‰ä¸ªéšå¼è½¬æ¢ï¼‰ï¼Œè‡³äºä¸ºä»€ä¹ˆå¯¹äº Go è¿™ç§åœ¨å…¶å®ƒè½¬æ¢æ–¹é¢è¦æ±‚ä¸¥æ ¼ï¼Œè€Œå¯¹äº &lt;code&gt;interface&lt;/code&gt; è¦é™¤å¤–å‘¢ï¼Œfor convenience å§ï¼Œå‘µå‘µâ€¦â€¦&lt;/p&gt;
&lt;p&gt;ç¢°åˆ°äº†è¿™ä¸ªå‘ï¼Œæˆ‘å°±å¼€å§‹å¥½å¥‡äº†ï¼ŒGo çš„ç±»å‹ç³»ç»Ÿåˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ&lt;/p&gt;
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Go" scheme="http://theo.im/tags/go/"/>
    
      <category term="Golang" scheme="http://theo.im/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>åˆ é™¤ Intel HD Graphics æ˜¾å¡å·¥å…·çš„å…¨å±€å¿«æ·é”®</title>
    <link href="http://theo.im/blog/2014/08/07/Remove-Intel-HD-Graphics-Hotkeys/"/>
    <id>http://theo.im/blog/2014/08/07/Remove-Intel-HD-Graphics-Hotkeys/</id>
    <published>2014-08-07T02:44:43.000Z</published>
    <updated>2016-05-22T13:48:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>Intelçš„å†…ç½®æ˜¾å¡å·¥å…·æ€»æ˜¯æ³¨å†Œå…¨å±€çš„å¿«æ·é”®ï¼Œè€Œä¸”è¿˜æ˜¯å¸¸ç”¨çš„ï¼ˆæ¯”å¦‚ <code>Sublime Text</code>, <code>PyCharm</code>ç­‰å·¥å…·çš„é»˜è®¤æŒ‰é”®ç»‘å®šï¼‰ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>Ctrl + Shift + Up</li><li>Ctrl + Shift + Down</li><li>Ctrl + Shift + Left</li><li>Ctrl + Shift + Right</li></ul><p>è¿™äº›å¿«æ·é”®éƒ½æ˜¯ç”± <code>igfxHK.exe</code> æ³¨å†Œçš„ï¼Œè™½ç„¶å¯ä»¥åœ¨ä»»åŠ¡æ ä¸­ç‚¹å‡»ç¦ç”¨å¿«æ·é”®ï¼Œä½†æ˜¯ç”±äºå¿«æ·é”®æ˜¯å…¨å±€æ³¨å†Œï¼Œå…¶å®ƒåº”ç”¨ç¨‹åºä»ç„¶ä¸èƒ½ä½¿ç”¨è¿™äº›å¿«æ·é”®ã€‚</p><p>è™½ç„¶ä½¿ç”¨ <code>taskkill /IM igfxHK.exe</code> æ¥å¼ºè¡Œç»ˆæ­¢å…¶è¿›ç¨‹ï¼Œé‡Šæ”¾å…¨å±€å¿«æ·é”®ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯æ¯æ¬¡é‡å¯éƒ½è¦é‡æ–°åšä¸€æ¬¡ï¼Œæ— è®ºæ˜¯å¦è‡ªåŠ¨åŒ–ï¼Œéƒ½æ„Ÿè§‰å¤ªäºŒé€¼äº†ï¼Œç»è¿‡ä¸€ç•ªçæ£ï¼Œå‘ç°å¯ä»¥é€šè¿‡è¯¥æ³¨å†Œè¡¨ï¼ŒæŠŠå¿«æ·é”®å®šä¹‰å…¨éƒ¨åˆ é™¤æ‰ï¼Œé¿å… <code>igfxHK.exe</code>å æœ‰è¿™äº›å…¨å±€å¿«æ·é”®ã€‚</p><p>æ³¨å†Œè¡¨æ–‡ä»¶å¦‚ä¸‹ï¼Œä¿å­˜ä¸ºä¸€ä¸ª <code>.reg</code> æ–‡ä»¶æœ€ååŒå‡»è¿è¡Œå¹¶å¯¼å…¥åˆ°æ³¨å†Œè¡¨å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Windows Registry Editor Version 5.00</div><div class="line"></div><div class="line">[HKEY_CURRENT_USER\Software\Intel\Display\igfxcui\HotKeys]</div><div class="line">&quot;3101&quot;=-</div><div class="line">&quot;3105&quot;=-</div><div class="line">&quot;3121&quot;=-</div><div class="line">&quot;9530&quot;=-</div><div class="line">&quot;3106&quot;=-</div><div class="line">&quot;3107&quot;=-</div><div class="line">&quot;3108&quot;=-</div><div class="line">&quot;3109&quot;=-</div><div class="line">&quot;3110&quot;=-</div><div class="line">&quot;4528&quot;=-</div><div class="line">&quot;10&quot;=-</div><div class="line">&quot;11&quot;=-</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Intelçš„å†…ç½®æ˜¾å¡å·¥å…·æ€»æ˜¯æ³¨å†Œå…¨å±€çš„å¿«æ·é”®ï¼Œè€Œä¸”è¿˜æ˜¯å¸¸ç”¨çš„ï¼ˆæ¯”å¦‚ &lt;code&gt;Sublime Text&lt;/code&gt;, &lt;code&gt;PyCharm&lt;/code&gt;ç­‰å·¥å…·çš„é»˜è®¤æŒ‰é”®ç»‘å®šï¼‰ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ctrl + Shift + Up&lt;/li&gt;
&lt;li&gt;
      
    
    </summary>
    
      <category term="Miscellaneous" scheme="http://theo.im/blog/categories/miscellaneous/"/>
    
    
  </entry>
  
  <entry>
    <title>VirtualBoxä¸æ€æ¯’è½¯ä»¶å†²çªå¯¼è‡´è™šæ‹Ÿæœºæ— æ³•å¯åŠ¨: é”™è¯¯ &quot;supR3HardenedWinReSpawn&quot;</title>
    <link href="http://theo.im/blog/2014/08/05/VirtualBox-error-launching-vm-instance-in-supR3HardenedWinReSpawn/"/>
    <id>http://theo.im/blog/2014/08/05/VirtualBox-error-launching-vm-instance-in-supR3HardenedWinReSpawn/</id>
    <published>2014-08-05T05:29:44.000Z</published>
    <updated>2016-05-22T13:49:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨å…¬å¸æœºå™¨ä¸Šè£…äº† VirtualBox (ç‰ˆæœ¬ 4.3.14) å’Œ Vagrant, åœ¨è¿è¡Œ <code>vagrant up</code> åæ€»æ˜¯æç¤ºè™šæ‹Ÿæœºä¸èƒ½å¯åŠ¨çš„é”™è¯¯ã€‚æ‰“å¼€ VirtualBox ç„¶åæ‰‹åŠ¨å¯åŠ¨è™šæ‹Ÿæœºå‘ç°å¦‚ä¸‹é”™è¯¯æ¡†ï¼š</p><p><img src="http://theo-im.qiniudn.com/images/virtualbox-error.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---------------------------</div><div class="line">VirtualBox - Error In supR3HardenedWinReSpawn</div><div class="line">---------------------------</div><div class="line">Error relaunching VirtualBox VM process: 5</div><div class="line">Command line: &apos;81954AF5-4D2F-31EB-A142-B7AF187A1C41-suplib-2ndchild --comment Work_default_1407215688716_8404 --startvm 93cdc421-ae20-49d6-8ca4-6c5570f809cd --no-startvm-errormsgbox&apos; (rc=-104)/&gt;</div><div class="line">---------------------------</div></pre></td></tr></table></figure><p>åŸå› :</p><ul><li>ä¸ Symantec Endpoint Protection å†²çª</li></ul><p>ä¸´æ—¶è§£å†³åŠæ³•ï¼š</p><ul><li>ä½¿ç”¨ 4.3.12 ç‰ˆæœ¬çš„ VirtualBoxï¼Œ<a href="https://www.virtualbox.org/wiki/Download_Old_Builds_4_3" target="_blank" rel="external">ç‚¹å‡»è¿™é‡Œä¸‹è½½</a>.</li></ul><p><strong>NOTE</strong> é™çº§ VirtualBox åéœ€è¦é‡æ–°å¯åŠ¨è®¡ç®—æœº</p><p>å¦å¤–å¯ä»¥<a href="https://forums.virtualbox.org/viewtopic.php?f=6&amp;t=62615" target="_blank" rel="external">å‚è€ƒVirtualBox è®ºå›çš„è®¨è®º</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»Šå¤©åœ¨å…¬å¸æœºå™¨ä¸Šè£…äº† VirtualBox (ç‰ˆæœ¬ 4.3.14) å’Œ Vagrant, åœ¨è¿è¡Œ &lt;code&gt;vagrant up&lt;/code&gt; åæ€»æ˜¯æç¤ºè™šæ‹Ÿæœºä¸èƒ½å¯åŠ¨çš„é”™è¯¯ã€‚æ‰“å¼€ VirtualBox ç„¶åæ‰‹åŠ¨å¯åŠ¨è™šæ‹Ÿæœºå‘ç°å¦‚ä¸‹é”™è¯¯æ¡†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=
      
    
    </summary>
    
      <category term="Miscellaneous" scheme="http://theo.im/blog/categories/miscellaneous/"/>
    
    
      <category term="Vagrant" scheme="http://theo.im/tags/vagrant/"/>
    
      <category term="VirtualBox" scheme="http://theo.im/tags/virtualbox/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Go ä¸­è·å– stacktrace</title>
    <link href="http://theo.im/blog/2014/07/21/Printing-stacktrace-in-Go/"/>
    <id>http://theo.im/blog/2014/07/21/Printing-stacktrace-in-Go/</id>
    <published>2014-07-21T13:30:12.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight go"><figcaption><span>æ‰“å° stacktrace</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1</span>&lt;&lt;<span class="number">16</span>)</div><div class="line"><span class="comment">// è·å– **æ‰€æœ‰** goroutine çš„ stacktrace</span></div><div class="line">runtime.Stack(buf, <span class="literal">true</span>)</div><div class="line"><span class="comment">// å¦‚æœéœ€è¦è·å– **å½“å‰** goroutine çš„ stacktrace, ç¬¬äºŒä¸ªå‚æ•°éœ€è¦ä¸º `false`</span></div><div class="line">runtime.Stack(buf, <span class="literal">true</span>)</div><div class="line">fmt.Println(<span class="keyword">string</span>(buf))</div></pre></td></tr></table></figure><p>å¤ªè¯¡å¼‚äº†ï¼Œå±…ç„¶è¦æŒ‡å®š buffer çš„å¤§å°ï¼Œç”¨èµ·æ¥ä¸æ–¹ä¾¿ã€‚è™½ç„¶å¯ä»¥ç»™ä¸ªâ€œè¶³å¤Ÿå¤§â€ buffer ç”¨æ¥å®¹çº³stacktraceï¼Œä½†æ˜¯ä»€ä¹ˆæ˜¯â€œè¶³å¤Ÿå¤§â€ï¼Ÿ</p><p>ä¸ºäº†ç¡®è®¤ <code>runtime.Stack()</code> å‡½æ•°çš„ behaviorï¼Œéœ€è¦å‚è€ƒä¸€ä¸‹ Go è¾“å‡º stacktrace çš„å®ç°ä»£ç ã€‚è¯¥ä»£ç æ˜¯ä½¿ç”¨ <a href="https://code.google.com/p/go/source/browse/src/cmd/dist/goc2c.c" target="_blank" rel="external">GOC</a> å†™æˆçš„ã€‚</p><blockquote><p>A .goc file is a combination of a limited form of Go with C.</p></blockquote><figure class="highlight go"><figcaption><span>mprof.goc</span><a href="https://code.google.com/p/go/source/browse/src/pkg/runtime/mprof.goc?name" target="_blank" rel="external">link</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Stack</span><span class="params">(b Slice, all <span class="keyword">bool</span>)</span> <span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">uintptr</span> pc, sp;</div><div class="line"></div><div class="line">    <span class="comment">// Stack pointer</span></div><div class="line">    sp = runtimeÂ·getcallersp(&amp;b);</div><div class="line">    <span class="comment">// Programer pointer</span></div><div class="line">    pc = (<span class="keyword">uintptr</span>)runtimeÂ·getcallerpc(&amp;b);</div><div class="line"></div><div class="line">    <span class="comment">// å¦‚æœé€‰æ‹©è¾“å‡ºæ‰€æœ‰ goroutine çš„ traceback, æŒ‚èµ·æ‰€æœ‰goroutine,</span></div><div class="line">    <span class="comment">// åœ¨æœ¬å‡½æ•°å®Œæˆåæ¢å¤</span></div><div class="line">    <span class="keyword">if</span>(all) &#123;</div><div class="line">        runtimeÂ·semacquire(&amp;runtimeÂ·worldsema, <span class="literal">false</span>);</div><div class="line">        m-&gt;gcing = <span class="number">1</span>;</div><div class="line">        runtimeÂ·stoptheworld();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(b.<span class="built_in">len</span> == <span class="number">0</span>)</div><div class="line">        n = <span class="number">0</span>;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="comment">// é‡å®šå‘è¾“å‡ºç¼“å†², æ‰“å°åˆ° `b` è¿™ä¸ªbufferé‡Œ</span></div><div class="line">        g-&gt;writebuf = (<span class="keyword">byte</span>*)b.array;</div><div class="line">        <span class="comment">// bufferå…·æœ‰å›ºå®šå¤§å°, å› æ­¤ä¼šæˆªæ–­</span></div><div class="line">        g-&gt;writenbuf = b.<span class="built_in">len</span>;</div><div class="line">        <span class="comment">// proc.c: runtimeÂ·goroutineheader</span></div><div class="line">        runtimeÂ·goroutineheader(g);</div><div class="line">        <span class="comment">// traceback_$&#123;arch&#125;.c</span></div><div class="line">        runtimeÂ·traceback(pc, sp, <span class="number">0</span>, g);</div><div class="line">        <span class="keyword">if</span>(all)</div><div class="line">            runtimeÂ·tracebackothers(g);</div><div class="line">        n = b.<span class="built_in">len</span> - g-&gt;writenbuf;</div><div class="line">        g-&gt;writebuf = <span class="literal">nil</span>;</div><div class="line">        g-&gt;writenbuf = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(all) &#123;</div><div class="line">        m-&gt;gcing = <span class="number">0</span>;</div><div class="line">        runtimeÂ·semrelease(&amp;runtimeÂ·worldsema);</div><div class="line">        runtimeÂ·starttheworld();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>å› ä¸ºæ‰“å°åˆ°bufferä¼šæˆªæ–­è¿‡é•¿çš„ç»“æœï¼Œå› æ­¤å¯ä»¥å†™ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">StackTrace</span><span class="params">(all <span class="keyword">bool</span>)</span> <span class="title">string</span></span> &#123;</div><div class="line">    <span class="comment">// Reserve 10K buffer at first</span></div><div class="line">    buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">10240</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        size := runtime.Stack(buf, all)</div><div class="line">        <span class="comment">// The size of the buffer may be not enough to hold the stacktrace,</span></div><div class="line">        <span class="comment">// so double the buffer size</span></div><div class="line">        <span class="keyword">if</span> size == <span class="built_in">len</span>(buf) &#123;</div><div class="line">            buf = <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="built_in">len</span>(buf)&lt;&lt;<span class="number">1</span>)</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(buf)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ä¾‹å­å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ï¼š<a href="http://play.golang.org/p/4ABrCVbH9g" target="_blank" rel="external">Go Playground</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight go&quot;&gt;&lt;figcaption&gt;&lt;span&gt;æ‰“å° stacktrace&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Go" scheme="http://theo.im/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæœåŠ¡å™¨</title>
    <link href="http://theo.im/blog/2014/05/20/use-aliyun-mirror-to-boost-up-download-speed/"/>
    <id>http://theo.im/blog/2014/05/20/use-aliyun-mirror-to-boost-up-download-speed/</id>
    <published>2014-05-20T03:40:29.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ¬æœºè®¿é—® <code>163.com</code> çš„ <code>CentOS</code> é•œåƒæ¯”è¾ƒä¸ç¨³å®šï¼Œä½“ç°åœ¨ ping å¾ˆä½ï¼Œä½†æ˜¯ HTTPè¿æ¥å¾ˆæ…¢ï¼Œ<code>yum</code> çš„ <code>fastestmirror</code> ä¹Ÿä¸å¤ªç†æƒ³ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½ç¦ç”¨ä¹‹ã€‚</p><p>å‘ç°é˜¿é‡Œäº‘çš„é•œåƒæœåŠ¡å™¨ï¼Œç«‹é©¬æ¢äº†ï¼Œä¾¿ç§˜ç«‹åˆ»å°±é€šäº†ã€‚</p><h2 id="yum-é•œåƒ"><a href="#yum-é•œåƒ" class="headerlink" title="yum é•œåƒ"></a>yum é•œåƒ</h2><h3 id="å®˜æ–¹æºé•œåƒ"><a href="#å®˜æ–¹æºé•œåƒ" class="headerlink" title="å®˜æ–¹æºé•œåƒ"></a>å®˜æ–¹æºé•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ç¦ç”¨ fastestmirror æ’ä»¶</span></div><div class="line">sed -i.backup <span class="string">'s/^enabled=1/enabled=0/'</span> /etc/yum/pluginconf.d/fastestmirror.conf</div><div class="line"><span class="comment"># å¤‡ä»½</span></div><div class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</div><div class="line"><span class="comment"># ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ</span></div><div class="line">wget -O /etc/yum.repos.d/CentOS-Base-aliyun.repo http://mirrors.aliyun.com/repo/Centos-6.repo</div></pre></td></tr></table></figure><h3 id="EPEL-é•œåƒ"><a href="#EPEL-é•œåƒ" class="headerlink" title="EPEL é•œåƒ"></a>EPEL é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å®‰è£… EPEL æº</span></div><div class="line">wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class="line">wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</div><div class="line">rpm -Uvh remi-release-6*.rpm epel-release-6*.rpm</div><div class="line"><span class="comment"># ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ</span></div><div class="line"><span class="keyword">if</span> [[ ! <span class="_">-f</span> /etc/yum.repos.d/epel.repo.backup ]]; <span class="keyword">then</span></div><div class="line">    mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup 2&gt;/dev/null || :</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [[ ! <span class="_">-f</span> /etc/yum.repos.d/epel-testing.repo.backup ]]; <span class="keyword">then</span></div><div class="line">    mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.backup 2&gt;/dev/null || :</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo</div></pre></td></tr></table></figure><h2 id="PyPi-é•œåƒ"><a href="#PyPi-é•œåƒ" class="headerlink" title="PyPi é•œåƒ"></a>PyPi é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mkdir -p ~/.pip</div><div class="line">touch ~/.pip/pip.conf</div><div class="line"></div><div class="line">sed -i.backup -r \</div><div class="line">    <span class="string">'s/^index-url\s*=\s*.+$/index-url = http:\/\/mirrors.aliyun.com\/pypi\/simple\//'</span> \</div><div class="line">    ~/.pip/pip.conf</div><div class="line"></div><div class="line"><span class="comment"># If file not changed, write contents back to pip.conf</span></div><div class="line">diff <span class="string">"~/.pip/pip.conf"</span> <span class="string">"~/.pip/pip.conf.backup"</span> &amp;&gt; /dev/null</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ]; <span class="keyword">then</span></div><div class="line">cat &gt; ~/.pip/pip.conf &lt;&lt;EOF</div><div class="line">[global]</div><div class="line">index-url = http://mirrors.aliyun.com/pypi/simple/</div><div class="line">EOF</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure><h2 id="RubyGems-é•œåƒ"><a href="#RubyGems-é•œåƒ" class="headerlink" title="RubyGems é•œåƒ"></a>RubyGems é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gem <span class="built_in">source</span> -r https://rubygems.org/</div><div class="line">gem <span class="built_in">source</span> <span class="_">-a</span> http://mirrors.aliyun.com/rubygems/</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘æœ¬æœºè®¿é—® &lt;code&gt;163.com&lt;/code&gt; çš„ &lt;code&gt;CentOS&lt;/code&gt; é•œåƒæ¯”è¾ƒä¸ç¨³å®šï¼Œä½“ç°åœ¨ ping å¾ˆä½ï¼Œä½†æ˜¯ HTTP
è¿æ¥å¾ˆæ…¢ï¼Œ&lt;code&gt;yum&lt;/code&gt; çš„ &lt;code&gt;fastestmirror&lt;/code&gt; ä¹Ÿä¸å¤ªç†æƒ³ï¼Œæ‰€ä»¥
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ FPM åˆ›å»º Python çš„ RPM åŒ…</title>
    <link href="http://theo.im/blog/2014/05/16/use-fpm-to-create-python-rpm-packages/"/>
    <id>http://theo.im/blog/2014/05/16/use-fpm-to-create-python-rpm-packages/</id>
    <published>2014-05-16T01:03:33.000Z</published>
    <updated>2016-05-22T13:48:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”Ÿæˆ RPM åŒ…å¤ªéº»çƒ¦äº†ï¼Œæœ€è¿‘çŸ¥é“äº†ä¸€ä¸ªåä¸º <a href="https://github.com/jordansissel/fpm" target="_blank" rel="external">FPM</a> çš„ç¥å™¨ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="å®‰è£…-FPM"><a href="#å®‰è£…-FPM" class="headerlink" title="å®‰è£… FPM"></a>å®‰è£… FPM</h2><p><strong>NOTE:</strong> æµ‹è¯•ç³»ç»Ÿä¸º RedHat ç³»çš„ CentOS 6.3ï¼Œç¼–è¯‘ Python 2.7.6 çš„ RPM åŒ…ã€‚</p><h3 id="å®‰è£…-Ruby"><a href="#å®‰è£…-Ruby" class="headerlink" title="å®‰è£… Ruby"></a>å®‰è£… Ruby</h3><p>ç”±äº <a href="https://github.com/jordansissel/fpm" target="_blank" rel="external">FPM</a> ä½¿ç”¨ <code>Ruby</code> å†™æˆï¼Œå› æ­¤ç³»ç»Ÿä¸­éœ€è¦å®‰è£… <code>Ruby</code> çš„è¿è¡Œç¯å¢ƒï¼ˆè¿™é‡Œ <code>gem</code> çš„æºæ”¹ä¸ºäº† taobao çš„é•œåƒï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Install ruby dependencies</span></div><div class="line">yum -y install ruby rubygems ruby-devel</div><div class="line"><span class="comment"># Use taobao repo for ruby gems</span></div><div class="line">gem sources <span class="_">-a</span> http://ruby.taobao.org/</div><div class="line"><span class="comment"># Remove origin repo from ruby gems</span></div><div class="line">gem sources --remove http://rubygems.org/</div></pre></td></tr></table></figure><h3 id="é€šè¿‡-Gem-å®‰è£…-FPM"><a href="#é€šè¿‡-Gem-å®‰è£…-FPM" class="headerlink" title="é€šè¿‡ Gem å®‰è£… FPM"></a>é€šè¿‡ Gem å®‰è£… FPM</h3><p>åœ¨ <code>Ruby</code> å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>gem</code> å®‰è£… <a href="https://github.com/jordansissel/fpm" target="_blank" rel="external">FPM</a> äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Install fpm</span></div><div class="line">gem install fpm</div></pre></td></tr></table></figure><p>Good.</p><h2 id="è®¾ç½®ç¼–è¯‘ç¯å¢ƒ"><a href="#è®¾ç½®ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="è®¾ç½®ç¼–è¯‘ç¯å¢ƒ"></a>è®¾ç½®ç¼–è¯‘ç¯å¢ƒ</h2><p>åœ¨ç¼–è¯‘ Python ä¹‹å‰ï¼Œéœ€è¦å®‰è£…å¼€å‘å·¥å…·å’Œåº“:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Install EPEL repository</span></div><div class="line">wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class="line">wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</div><div class="line">rpm -Uvh remi-release-6*.rpm epel-release-6*.rpm</div><div class="line"></div><div class="line"><span class="comment"># Install build toolchain</span></div><div class="line">yum -y groupinstall <span class="string">"Development tools"</span></div><div class="line">yum -y install openssl-devel readline-devel bzip2-devel sqlite-devel zlib-devel ncurses-devel db4-devel expat-devel</div></pre></td></tr></table></figure><h2 id="ç¼–è¯‘å¹¶åˆ›å»º-Python-çš„-RPM-åŒ…"><a href="#ç¼–è¯‘å¹¶åˆ›å»º-Python-çš„-RPM-åŒ…" class="headerlink" title="ç¼–è¯‘å¹¶åˆ›å»º Python çš„ RPM åŒ…"></a>ç¼–è¯‘å¹¶åˆ›å»º Python çš„ RPM åŒ…</h2><p><a href="https://github.com/jordansissel/fpm" target="_blank" rel="external">FPM</a> çš„ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/jordansissel/fpm" target="_blank" rel="external">FPM</a> çš„ <a href="https://github.com/jordansissel/fpm/wiki" target="_blank" rel="external">ä½¿ç”¨è¯´æ˜</a>ã€‚</p><p>é¦–å…ˆï¼Œä¸‹è½½ Python-2.7.6 çš„æºç åŒ…å¹¶è§£å‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl --progress-bar -LO http://mirrors.sohu.com/python/2.7.6/Python-2.7.6.tgz</div><div class="line">tar xf Python-2.7.6.tgz</div></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œç¼–è¯‘ Python-2.7.6</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> Python-2.7.6.tgz</div><div class="line"></div><div class="line"><span class="comment"># Python2.7ç¼–è¯‘å®‰è£…åä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½•ï¼Œæ–¹ä¾¿æ‰“åŒ…</span></div><div class="line"><span class="built_in">export</span> INTERMEDIATE_INSTALL_DIR=/tmp/installdir-Python-2.7.6</div><div class="line"><span class="comment"># RPMåŒ…å®‰è£…åPython2.7çš„ç›®å½•</span></div><div class="line"><span class="built_in">export</span> INSTALL_DIR=/usr/<span class="built_in">local</span></div><div class="line"></div><div class="line">LDFLAGS=<span class="string">"-Wl,-rpath=<span class="variable">$&#123;INSTALL_DIR&#125;</span>/lib <span class="variable">$&#123;LDFLAGS&#125;</span>"</span> \</div><div class="line">            ./configure --prefix=<span class="variable">$&#123;INSTALL_DIR&#125;</span> --enable-unicode=ucs4 \</div><div class="line">                --enable-shared --enable-ipv6</div><div class="line">make</div><div class="line">make install DESTDIR=<span class="variable">$&#123;INTERMEDIATE_INSTALL_DIR&#125;</span></div></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨ <a href="https://github.com/jordansissel/fpm" target="_blank" rel="external">FPM</a> åˆ›å»º RPM åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># æ³¨æ„ä¹‹å‰å¯¼å‡º INTERMEDIATE_INSTALL_DIR å’Œ INSTALL_DIR è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œè¿˜è¦ä½¿ç”¨</span></div><div class="line">fpm <span class="_">-s</span> dir -t <span class="_">-f</span> rpm -n python27 -v <span class="string">'2.7.6'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'openssl'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'bzip2'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'zlib'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'expat'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'db4'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'sqlite'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'ncurses'</span> \</div><div class="line">    <span class="_">-d</span> <span class="string">'readline'</span> \</div><div class="line">    --directories=<span class="variable">$&#123;INSTALL_DIR&#125;</span>/lib/python2.7/ \</div><div class="line">    --directories=<span class="variable">$&#123;INSTALL_DIR&#125;</span>/include/python2.7/ \</div><div class="line">    -C <span class="variable">$&#123;INTERMEDIATE_INSTALL_DIR&#125;</span> .</div></pre></td></tr></table></figure><h2 id="Bonus-Time"><a href="#Bonus-Time" class="headerlink" title="Bonus Time"></a>Bonus Time</h2><p>åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è‡ªåŠ¨ä¸‹è½½ã€ç¼–è¯‘ã€æ‰“åŒ… Python RPM åŒ…çš„ Makefileï¼›</li><li>è‡ªåŠ¨ä¸‹è½½ã€ç¼–è¯‘ã€æ‰“åŒ… virtualenvã€pipã€supervisor ç­‰ Python åº“å’Œå·¥å…·çš„ RPM åŒ…ã€‚</li></ul><p>GitHub é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/timonwong/python27-rpm" target="_blank" rel="external">python27-rpm</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç”Ÿæˆ RPM åŒ…å¤ªéº»çƒ¦äº†ï¼Œæœ€è¿‘çŸ¥é“äº†ä¸€ä¸ªåä¸º &lt;a href=&quot;https://github.com/jordansissel/fpm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FPM&lt;/a&gt; çš„ç¥å™¨ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…-FP
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Python" scheme="http://theo.im/tags/python/"/>
    
      <category term="FPM" scheme="http://theo.im/tags/fpm/"/>
    
      <category term="RPM" scheme="http://theo.im/tags/rpm/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQç¬”è®°ï¼ˆä¸‰ï¼‰: Pikaå®¢æˆ·ç«¯ï¼ˆPythonï¼‰å‘é€å¤§å°ºå¯¸æ¶ˆæ¯çš„é—®é¢˜</title>
    <link href="http://theo.im/blog/2014/05/15/rabbitmq-note-3-pika-send-large-message/"/>
    <id>http://theo.im/blog/2014/05/15/rabbitmq-note-3-pika-send-large-message/</id>
    <published>2014-05-15T02:27:25.000Z</published>
    <updated>2016-05-22T13:48:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>è¿™ä¸ªé—®é¢˜å­˜åœ¨å¾ˆä¹…äº†ï¼Œç°è±¡å°±æ˜¯ä½¿ç”¨ <a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a> åº“çš„å®¢æˆ·ç«¯åœ¨å‘é€å¤§å°ºå¯¸æ¶ˆæ¯åï¼ŒRabbitMQæ²¡æœ‰æ”¶åˆ°ï¼ŒConsumer é‚£é‡Œä¼šè®¤ä¸ºæ¶ˆæ¯å·²ä¸¢å¤±ã€‚</p><p><strong>NOTE:</strong> å³ä½¿åœ¨æœ¬æ–‡å†™æ—¶çš„æœ€æ–°ç‰ˆ(v0.9.13)ä¾ç„¶å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å› ä¸ºç½‘ç»œçŠ¶æ€å¾ˆå¥½ï¼Œæ‰€ä»¥æ²¡æœ‰è€ƒè™‘ç½‘ç»œçš„é”™è¯¯ï¼Œç›´æ¥è€ƒè™‘<a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a>åº“çš„é—®é¢˜ã€‚</p><p>é‚£ä¹ˆç¬¬ä¸€æ­¥å°±æ˜¯æŠŠ <a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a> çš„ä»£ç æ‹¿æ¥è¯»ä¸€éï¼Œä¸»è¦çœ‹å®ƒæ˜¯æ€ä¹ˆå‘é€æ¶ˆæ¯çš„ï¼Œç»è¿‡ä¸€ç•ªæ¢ç´¢ï¼Œæ‰¾åˆ°äº†<code>pika/adapters/base_connection.py</code> è¿™ä¸ªæ–‡ä»¶ï¼Œæ¥çœ‹çœ‹é‡Œé¢çš„å†…å®¹ï¼š</p><figure class="highlight python"><figcaption><span>pika/adapters/base_connection.py</span><a href="https://github.com/pika/pika/blob/0.9.13/pika/adapters/base_connection.py#L329" target="_blank" rel="external">link</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_write</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="string">"""Handle any outbound buffer writes that need to take place."""</span></div><div class="line">    total_written = <span class="number">0</span></div><div class="line">    <span class="keyword">if</span> self.outbound_buffer:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            bytes_written = self.socket.send(self.outbound_buffer.popleft())</div><div class="line">        <span class="keyword">except</span> socket.timeout:</div><div class="line">            <span class="keyword">raise</span></div><div class="line">        <span class="keyword">except</span> socket.error, error:</div><div class="line">            <span class="keyword">return</span> self._handle_error(error)</div><div class="line">        total_written += bytes_written</div><div class="line">    <span class="keyword">return</span> total_written</div></pre></td></tr></table></figure><p>çœ‹å‡ºé—®é¢˜äº†å—ï¼Ÿ</p><p>æ¥çœ‹çœ‹<code>socket.send</code>çš„æ–‡æ¡£å§ï¼š</p><blockquote><p>Send data to the socket. The socket must be connected to a remote socket. The optional flags argument has the same meaning as for recv() above. Returns the number of bytes sent. Applications are responsible for checking that all data has been sent; if only some of the data was transmitted, the application needs to attempt delivery of the remaining data. For further information on this concept, consult the Socket Programming HOWTO.</p><footer><strong>Python Docs</strong><cite><a href="https://docs.python.org/2/library/socket.html#socket.socket.send" target="_blank" rel="external">socket.send</a></cite></footer></blockquote><p>é—®é¢˜å°±æ˜¯ï¼Œæ²¡æœ‰æ£€æŸ¥ <code>socket.send</code> çš„è¿”å›å€¼ï¼Œç”±äº <code>socket.send</code> è¿”å›å®é™…å‘é€çš„ç›´æ¥ä¸ªæ•°ï¼Œå¯èƒ½ä¼šå°äºæœŸæœ›ï¼ˆåœ¨è¿™é‡Œæ˜¯<code>self.outbound_buffer.popleft()</code>ï¼‰ã€‚</p><p>ç”±äº <code>socket.send</code> å¯èƒ½æ²¡æœ‰å°†æ•°æ®å‘é€å®Œæˆå°±è¿”å›äº†ï¼Œé€ æˆäº†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚</p><p>æœ¬æ¥æƒ³è‡ªå·±ä¿®çš„ï¼Œçœ‹äº†ä¸€çœ¼ <a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a> çš„ <code>master</code> åˆ†æ”¯ï¼Œå·²ç»ä¿®æ­£äº†ï¼ˆä¸€æ¬¡ä¿è¯å°†ä¸€ä¸ªå¸§(Frame)å‘é€å®Œæˆï¼‰ï¼š</p><figure class="highlight python"><figcaption><span>pika/adapters/base_connection.py</span><a href="https://github.com/pika/pika/blob/master/pika/adapters/base_connection.py#L354" target="_blank" rel="external">link</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_write</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="string">"""Handle any outbound buffer writes that need to take place."""</span></div><div class="line">    bytes_written = <span class="number">0</span></div><div class="line">    <span class="keyword">if</span> self.outbound_buffer:</div><div class="line">        frame = self.outbound_buffer.popleft()</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            self.socket.sendall(frame)</div><div class="line">            bytes_written = len(frame)</div><div class="line">        <span class="keyword">except</span> socket.timeout:</div><div class="line">            <span class="keyword">raise</span></div><div class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> error:</div><div class="line">            <span class="keyword">return</span> self._handle_error(error)</div><div class="line">    <span class="keyword">return</span> bytes_written</div></pre></td></tr></table></figure><p>å‘µå‘µâ€¦â€¦</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><ol><li>è‡ªè¡Œæ‰“è¡¥ä¸ï¼›</li><li>ä½¿ç”¨ <code>git</code> ä¸Šçš„ Pika: <code>pip install git+https://github.com/pika/pika.git</code>ï¼›</li><li>ä¸ç”¨ <a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a>, æ¢å…¶å®ƒçš„ï¼Œæ¯”å¦‚ <a href="http://kombu.readthedocs.org/" target="_blank" rel="external">Kombu</a>ã€‚</li></ol><p>æˆ‘ç°åœ¨ä¸ç”¨ <a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a> äº†ï¼Œç”¨ <a href="http://kombu.readthedocs.org/" target="_blank" rel="external">Kombu</a>ã€‚</p><p><strong>PS:</strong> <a href="https://pypi.python.org/pypi/pika/" target="_blank" rel="external">Pika</a> çš„å‘å¸ƒä¹Ÿå¤ªä¸ç§¯æäº†ï¼Œéƒ½æ€ä¹ˆä¹…äº†è¿˜ä¸å‘æ–°ç‰ˆæœ¬ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªé—®é¢˜å­˜åœ¨å¾ˆä¹…äº†ï¼Œç°è±¡å°±æ˜¯ä½¿ç”¨ &lt;a href=&quot;https://pypi.python.org/pypi/pika/&quot; 
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Python" scheme="http://theo.im/tags/python/"/>
    
      <category term="RabbitMQ" scheme="http://theo.im/tags/rabbitmq/"/>
    
      <category term="Pika" scheme="http://theo.im/tags/pika/"/>
    
  </entry>
  
  <entry>
    <title>è§£å†³GitHub Pagesçš„302è½¬å‘é—®é¢˜</title>
    <link href="http://theo.im/blog/2014/05/14/resolve-302-redirection-on-github-pages/"/>
    <id>http://theo.im/blog/2014/05/14/resolve-302-redirection-on-github-pages/</id>
    <published>2014-05-14T02:34:21.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p><strong>NOTE:</strong> å¦‚æœç»™GitHub Pagesä½¿ç”¨çš„æ˜¯å­åŸŸåï¼ŒæŒ‰ç…§<a href="https://help.github.com/articles/setting-up-a-custom-domain-with-github-pages" target="_blank" rel="external">GitHub Pagesæ–‡æ¡£</a>é…ç½®ï¼Œä¸ä¼šå‡ºç°è¯¥é—®é¢˜ã€‚</p><p>ç”±äºæˆ‘åœ¨GitHub Pagesä¸Šçš„æ­çš„åšå®¢ä½¿ç”¨äº†<code>theo.im</code>è¿™ä¸ªæ ¹åŸŸå(Apex Domain)ï¼Œåœ¨æŒ‰ç…§<a href="https://help.github.com/articles/setting-up-a-custom-domain-with-github-pages" target="_blank" rel="external">GitHub Pagesæ–‡æ¡£</a>ä¸Šæä¾›çš„ä¿¡æ¯ï¼Œå¯¹<code>theo.im</code>è®¾ç½®äº†<strong>Aè®°å½•</strong>ï¼Œä½†æ˜¯é€šè¿‡æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -I http://theo.im/sitemap.xml</div></pre></td></tr></table></figure><p>å‘ç°å¾—åˆ°çš„æ˜¯302è½¬å‘ï¼Œä¸ç¬¦åˆSitemapåè®®çš„è¦æ±‚ï¼š</p><blockquote><p>A successful request will return an HTTP 200 response code; if you receive a different response, you should resubmit your request. The HTTP 200 response code only indicates that the search engine has received your Sitemap, not that the Sitemap itself or the URLs contained in it were valid.</p><footer><strong>sitemaps.org</strong><cite><a href="http://www.sitemaps.org/protocol.html" target="_blank" rel="external">Sitemaps Protocol</a></cite></footer></blockquote><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>é€šè¿‡æœç´¢ï¼Œæˆ‘å‘ç°éœ€è¦ä½¿ç”¨<strong>ALIASè®°å½•</strong>è§£ææ ¹åŸŸåï¼Œä½†æ˜¯ç”±äºæˆ‘ä¹‹å‰ä½¿ç”¨çš„æ˜¯<a href="http://dnspod.cn" target="_blank" rel="external">DNSPod</a>çš„æœåŠ¡ï¼Œä¸æ”¯æŒ<strong>ALIASè®°å½•</strong>ï¼Œå› æ­¤å†³å®šæ¢åŠ DNSåŸŸåè§£æå•†ã€‚</p><p>ç»è¿‡ä¸€ç•ªæœå¯»ï¼Œæ‰¾åˆ°äº†ä¸¤å®¶æ”¯æŒ<strong>ALIASè®°å½•</strong>çš„DNSåŸŸåè§£æå•†ï¼š</p><ol><li><a href="https://dnsimple.com/" target="_blank" rel="external">DNSimple</a>: å…¨æ”¶è´¹æœåŠ¡</li><li><a href="https://pointhq.com/" target="_blank" rel="external">PointDNS</a>: æœ‰å…è´¹çš„å¼€å‘è€…è´¦æˆ·</li></ol><p>æœ¬ç€èƒ½ç”¨æ”¶è´¹ä¸ç”¨å…è´¹çš„åŸåˆ™ï¼Œå› æ­¤æˆ‘é€‰æ‹©äº† <a href="https://dnsimple.com/" target="_blank" rel="external">DNSimple</a> æ¥è§£ææˆ‘çš„åŸŸå (ã‚œoã‚œ(â˜†â—‹=(-_-)</p><p><img src="http://theo-im.qiniudn.com/images/github-pages-dns-buybuybuy.jpg" alt=""></p><p>OKï¼Œä¸‡æ–‡ä¸å¦‚ä¸€å›¾ï¼š</p><p><img src="http://theo-im.qiniudn.com/images/github-pages-dns-setup.png" alt=""></p><p>æœ€åï¼Œè¿è¡Œ <code>dig theo.im +nostats +nocomments +nocmd</code> æ£€æŸ¥DNSæ˜¯å¦ç”Ÿæ•ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.23.rc1.el6_5.1 &lt;&lt;&gt;&gt; theo.im +nostats +nocomments +nocmd</div><div class="line">;; global options: +cmd</div><div class="line">;theo.im.           IN  A</div><div class="line">theo.im.        3600    IN  A   199.27.79.133</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; å¦‚æœç»™GitHub Pagesä½¿ç”¨çš„æ˜¯å­åŸŸåï¼ŒæŒ‰ç…§&lt;a href=&quot;https://help.
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="GitHub" scheme="http://theo.im/tags/github/"/>
    
      <category term="DNS" scheme="http://theo.im/tags/dns/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQç¬”è®°ï¼ˆäºŒï¼‰: å¹¶å‘è¿æ¥æ•°</title>
    <link href="http://theo.im/blog/2014/05/13/rabbitmq-note-2-about-simultaneous-connections/"/>
    <id>http://theo.im/blog/2014/05/13/rabbitmq-note-2-about-simultaneous-connections/</id>
    <published>2014-05-13T08:16:21.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h2><p>å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œå¹¶å‘è¿æ¥æ•°ä¸€ç›´æ˜¯ä¸€ä¸ªéœ€è¦è€ƒé‡çš„é—®é¢˜ï¼Œå› æ­¤åœ¨è¿™é‡Œåšä¸€ä¸ªç®€å•çš„æµ‹è¯•ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>åœ¨æµ‹è¯•å‰ï¼Œéœ€è¦å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯ç¯å¢ƒï¼Œæœ¬æ–‡çš„ç¯å¢ƒæ˜¯:</p><ul><li>CentOS 6.3</li><li>Python 2.7.6<ul><li><a href="http://kombu.readthedocs.org/" target="_blank" rel="external">Kombu</a></li></ul></li></ul><p><strong>NOTE:</strong> ä¸‹æ–‡ä¸­çš„ IP åœ°å€ <code>10.10.0.70</code> ä¸º RabbitMQ æœåŠ¡å™¨çš„ IP åœ°å€</p><h3 id="æµ‹è¯•-è€—å°½-rabbitmq-çš„-socket-descriptors"><a href="#æµ‹è¯•-è€—å°½-rabbitmq-çš„-socket-descriptors" class="headerlink" title="æµ‹è¯•: è€—å°½ rabbitmq çš„ socket descriptors"></a>æµ‹è¯•: è€—å°½ rabbitmq çš„ socket descriptors</h3><p>é¦–å…ˆ, ç¼–å†™ä¸€ä¸ªè„šæœ¬:</p><figure class="highlight python"><figcaption><span>exhaust_socket_descriptors.py</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> logging</div><div class="line"></div><div class="line"><span class="keyword">import</span> config</div><div class="line"></div><div class="line">logging.basicConfig(format=<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>,</div><div class="line">                    level=logging.INFO)</div><div class="line">LOG = logging.getLogger(os.path.basename(__file__))</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    connections = []</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        LOG.info(<span class="string">"Try to establish a new rabbit connection..."</span>)</div><div class="line">        connection = config.get_connection()</div><div class="line">        connection.connect()</div><div class="line">        connections.append(connection)</div><div class="line">        LOG.info(<span class="string">"[%d] connections"</span>, len(connections))</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure><p>åœ¨<strong>å®¢æˆ·ç«¯</strong>æ‰§è¡Œ<code>exhaust_socket_descriptors.py</code>, ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">...å‰ç•¥...</div><div class="line">2014-05-13 10:45:17,477 - exhaust_socket_descriptors.py - INFO - Try to establish a new rabbit connection...</div><div class="line">2014-05-13 10:45:17,489 - exhaust_socket_descriptors.py - INFO - [826] connections</div><div class="line">2014-05-13 10:45:17,489 - exhaust_socket_descriptors.py - INFO - Try to establish a new rabbit connection...</div><div class="line">2014-05-13 10:45:17,502 - exhaust_socket_descriptors.py - INFO - [827] connections</div><div class="line">2014-05-13 10:45:17,502 - exhaust_socket_descriptors.py - INFO - Try to establish a new rabbit connection...</div><div class="line">2014-05-13 10:45:17,516 - exhaust_socket_descriptors.py - INFO - [828] connections</div><div class="line">2014-05-13 10:45:17,516 - exhaust_socket_descriptors.py - INFO - Try to establish a new rabbit connection...</div><div class="line">2014-05-13 10:45:17,528 - exhaust_socket_descriptors.py - INFO - [829] connections</div><div class="line">2014-05-13 10:45:17,529 - exhaust_socket_descriptors.py - INFO - Try to establish a new rabbit connection...</div></pre></td></tr></table></figure><p>çœ‹åˆ°ä¼¼ä¹æ˜¯è¿æ¥è€—å°½äº†ï¼Œåœ¨<strong>æœåŠ¡å™¨ç«¯</strong>ä¸Šç¡®è®¤ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost vagrant]# rabbitmqctl status | grep sockets_</div><div class="line">      &#123;sockets_limit,829&#125;,</div><div class="line">      &#123;sockets_used,829&#125;]&#125;,</div></pre></td></tr></table></figure><p><code>sockets_used</code> ä¸ <code>sockets_limit</code> ç›¸åŒï¼Œå¯ä»¥ç¡®è®¤ socket descriptors è€—å°½äº†ï¼Œå› æ­¤å®¢æˆ·ç«¯æˆåŠŸæ–°è¿æ¥ï¼Œå¡åœ¨<code>Try to establish a new rabbit connection...</code> å¤„ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œ<strong>ä¸ºä»€ä¹ˆä¸è¶…æ—¶ï¼Ÿ</strong></p><p>åœ¨<strong>å®¢æˆ·ç«¯</strong>ä¸­æ£€æŸ¥ä¸€ä¸‹TCPè¿æ¥ä¸ªæ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# netstat -atn | grep 10.10.0.70:5672 | wc -l</div><div class="line">830</div></pre></td></tr></table></figure><p>å¯ä»¥å¾—å‡ºï¼Œsocketè¿æ¥æ•°æ˜¯830ï¼Œå¤§äºæœåŠ¡å™¨ç«¯çš„<code>sockets_limit</code></p><p>ç»§ç»­ï¼Œåœ¨<strong>å®¢æˆ·ç«¯</strong>ä¸­ï¼Œæ£€æŸ¥ä¸€ä¸‹TCPè¿æ¥çŠ¶æ€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# netstat -atn | grep 10.10.0.70:5672  | awk &apos;&#123;print $6&#125;&apos; | uniq</div><div class="line">ESTABLISHED</div></pre></td></tr></table></figure><p><strong>å…¨éƒ¨éƒ½æ˜¯ESTABLISHEDçŠ¶æ€</strong>ï¼Œå› æ­¤æœåŠ¡å™¨ä»…ä»…æ˜¯é˜»å¡äº†æ–°è¿æ¥ï¼Œè€Œä¸æ˜¯æ‹’ç»æ–°è¿æ¥ã€‚è¿™æ ·ï¼Œå°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼š</p><p>å¦‚æœæ˜¯ä½¿ç”¨ <a href="http://clusterlabs.org/" target="_blank" rel="external">HAProxy</a> ç­‰å·¥å…·æ­å»ºçš„é›†ç¾¤ï¼Œç”±äº<strong>æœåŠ¡å™¨ä¾ç„¶ä¼šæ¥å—æ–°è¿æ¥</strong>ï¼Œå› æ­¤ <a href="http://clusterlabs.org/" target="_blank" rel="external">HAProxy</a> ä¸ä¼šè®¤ä¸ºèŠ‚ç‚¹å·²Downï¼Œ<strong>æœ€ç»ˆä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤å¡ä½</strong>ï¼›</p><h3 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h3><p>å½“ RabbitMQ çš„ <code>sockets_used</code> è¾¾åˆ° <code>sockets_limits</code> æ—¶å€™ï¼ˆè¿æ¥æ•°è€—å°½æ—¶ï¼‰ï¼Œæœ€ç»ˆå³ä½¿æ˜¯ Consumerä¹Ÿä¼šå…¨éƒ¨é˜»å¡ï¼Œåªæœ‰åœ¨ <code>sockets_used &lt; sockets_limit</code> æ—¶ï¼ˆé‡Šæ”¾éƒ¨åˆ†è¿æ¥åï¼‰ï¼Œæ‰ä¼šæ¢å¤ã€‚</p><p>å‚è§ä»¥ä¸‹è¿æ¥è·å–æ›´å¤šä¿¡æ¯: <a href="http://markmail.org/message/r4yhvqc7vgfljpao" target="_blank" rel="external">http://markmail.org/message/r4yhvqc7vgfljpao</a></p><h2 id="Workaround-å¢åŠ File-Socket-Descriptorsä¸ªæ•°"><a href="#Workaround-å¢åŠ File-Socket-Descriptorsä¸ªæ•°" class="headerlink" title="Workaround: å¢åŠ File/Socket Descriptorsä¸ªæ•°"></a>Workaround: å¢åŠ File/Socket Descriptorsä¸ªæ•°</h2><p>é€šè¿‡å®˜æ–¹(åŒ…æ‹¬EPEL)çš„ <code>deb</code>, <code>rpm</code> åŒ…å®‰è£…çš„å¯åŠ¨è„šæœ¬ï¼Œéƒ½ä¼šåœ¨<code>rabbitmq-server</code>å¯åŠ¨å‰ <code>source</code> ä¸€æ¬¡ <code>/etc/default/rabbitmq-server</code> æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­å¢åŠ æœ€å¤§å…è®¸çš„File/Socket Descriptors ä¸ªæ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'ulimit -n 102400'</span> &gt; /etc/default/rabbitmq-server</div></pre></td></tr></table></figure><p>æœ€åï¼Œé‡å¯ RabbitMQ æœåŠ¡å™¨ä»¥ç”Ÿæ•ˆè¯¥è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service rabbitmq-server restart</div></pre></td></tr></table></figure><h2 id="Updated"><a href="#Updated" class="headerlink" title="Updated"></a>Updated</h2><h3 id="May-17-2014"><a href="#May-17-2014" class="headerlink" title="May 17, 2014"></a>May 17, 2014</h3><ul><li>æ›´æ–° Bug è¯´æ˜ (RabbitMQ <code>bug26180</code>)</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ¦‚è¦&quot;&gt;&lt;a href=&quot;#æ¦‚è¦&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¦&quot;&gt;&lt;/a&gt;æ¦‚è¦&lt;/h2&gt;&lt;p&gt;å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œå¹¶å‘è¿æ¥æ•°ä¸€ç›´æ˜¯ä¸€ä¸ªéœ€è¦è€ƒé‡çš„é—®é¢˜ï¼Œå› æ­¤åœ¨è¿™é‡Œåšä¸€ä¸ªç®€å•çš„æµ‹è¯•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æµ‹è¯•&quot;&gt;&lt;a href=&quot;#æµ‹è¯•&quot;
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="RabbitMQ" scheme="http://theo.im/tags/rabbitmq/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQç¬”è®°ï¼ˆä¸€ï¼‰: é€šè¿‡Vagrantå»ºç«‹ä¸€ä¸ªRabbitMQæœåŠ¡å™¨å®éªŒç¯å¢ƒ</title>
    <link href="http://theo.im/blog/2014/05/13/rabbitmq-note-1-setup-experimental-rabbitmq-environment-using-vagrant/"/>
    <id>http://theo.im/blog/2014/05/13/rabbitmq-note-1-setup-experimental-rabbitmq-environment-using-vagrant/</id>
    <published>2014-05-13T06:46:31.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…Vagrant"><a href="#å®‰è£…Vagrant" class="headerlink" title="å®‰è£…Vagrant"></a>å®‰è£…Vagrant</h2><p>åœ¨<a href="http://vagrantup.com" target="_blank" rel="external">å®˜æ–¹ç½‘ç«™</a>ä¸Šï¼Œä¸‹è½½å¹¶å®‰è£…Vagrant</p><p><strong>NOTE</strong>: Vagrant 1.6ç‰ˆæœ¬å¯¹<code>CentOS</code>çš„guestæ”¯æŒä¸å¥½ï¼Œä¸èƒ½æ­£ç¡®è®¾ç½®ç½‘ç»œè¿æ¥ï¼Œéœ€è¦å‡çº§åˆ°æœ€æ–°ç‰ˆæˆ–æ‰“ä¸Šä¸‹é¢è¿™ä¸ªè¡¥ä¸: <a href="https://github.com/cammoraton/vagrant/commit/1e4584cde51765972af41cd48fc0409756a8fd59" target="_blank" rel="external">Fix issue reported at mitchellh#3649</a></p><h2 id="ä¸‹è½½å¹¶å¯¼å…¥CentOS-6-3-Box"><a href="#ä¸‹è½½å¹¶å¯¼å…¥CentOS-6-3-Box" class="headerlink" title="ä¸‹è½½å¹¶å¯¼å…¥CentOS 6.3 Box"></a>ä¸‹è½½å¹¶å¯¼å…¥CentOS 6.3 Box</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vagrant box add --name centos63 <span class="string">'https://s3.amazonaws.com/itmat-public/centos-6.3-chef-10.14.2.box'</span></div></pre></td></tr></table></figure><h2 id="åˆ›å»ºVagrantfile"><a href="#åˆ›å»ºVagrantfile" class="headerlink" title="åˆ›å»ºVagrantfile"></a>åˆ›å»ºVagrantfile</h2><p><code>Vagrantfile</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight ruby"><figcaption><span>Vagrantfile</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- mode: ruby -*-</span></div><div class="line"><span class="comment"># vi: set ft=ruby :</span></div><div class="line"></div><div class="line"><span class="comment"># Vagrantfile API/syntax version. Don't touch unless you know what you're doing!</span></div><div class="line">VAGRANTFILE_API_VERSION = <span class="string">"2"</span></div><div class="line"></div><div class="line">Vagrant.configure(VAGRANTFILE_API_VERSION) <span class="keyword">do</span> <span class="params">|config|</span></div><div class="line">  config.vm.box = <span class="string">"centos63"</span></div><div class="line"></div><div class="line">  <span class="comment"># ä¸€ä¸ªHost-Onlyçš„Network, IPåœ°å€å¯ä»¥è‡ªå®šä¹‰, æ–¹ä¾¿è®¿é—®</span></div><div class="line">  config.vm.network <span class="symbol">:private_network</span>, <span class="symbol">ip:</span> <span class="string">"10.10.0.70"</span>, <span class="symbol">netmask:</span> <span class="string">"255.255.255.0"</span></div><div class="line"></div><div class="line">  <span class="comment"># config.vm.synced_folder "../", "/vagrant"</span></div><div class="line"></div><div class="line">  config.vm.provider <span class="symbol">:virtualbox</span> <span class="keyword">do</span> <span class="params">|vb|</span></div><div class="line">    <span class="comment"># è°ƒèŠ‚è™šæ‹ŸæœºCPUä¸ªæ•°</span></div><div class="line">    vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--cpus"</span>, <span class="string">"2"</span>]</div><div class="line">    <span class="comment"># è°ƒèŠ‚è™šæ‹Ÿæœºå†…å­˜å¤§å°</span></div><div class="line">    vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--memory"</span>, <span class="string">"2048"</span>]</div><div class="line">    vb.customize [<span class="string">"modifyvm"</span>, <span class="symbol">:id</span>, <span class="string">"--natdnshostresolver1"</span>, <span class="string">"on"</span>]</div><div class="line">    vb.customize [<span class="string">"setextradata"</span>, <span class="symbol">:id</span>, <span class="string">"VBoxInternal2/SharedFoldersEnableSymlinksCreate/vagrant"</span>, <span class="string">"1"</span>]</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="comment"># è‡ªåŠ¨å®‰è£…è„šæœ¬</span></div><div class="line">  config.vm.provision <span class="symbol">:shell</span>, <span class="symbol">path:</span> <span class="string">"provision.sh"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure><p>ä¸ºäº†ç®€åŒ–å®‰è£…ï¼Œæä¾›ä¸€ä¸ªç”¨äºè‡ªåŠ¨å®‰è£…çš„è„šæœ¬<code>provision.sh</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/env bash</span></div><div class="line"></div><div class="line"><span class="comment"># Disable yum fastestmirror plugin</span></div><div class="line">sed -i.backup <span class="string">'s/^enabled=1/enabled=0/'</span> /etc/yum/pluginconf.d/fastestmirror.conf</div><div class="line"><span class="comment"># Change yum mirror (163)</span></div><div class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</div><div class="line">wget -O /etc/yum.repos.d/CentOS-Base-163.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo</div><div class="line">yum makecache</div><div class="line">yum update</div><div class="line"></div><div class="line"><span class="comment"># Install EPEL repository</span></div><div class="line">wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</div><div class="line">wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</div><div class="line">rpm -Uvh remi-release-6*.rpm epel-release-6*.rpm</div><div class="line"></div><div class="line"><span class="comment"># Install and start rabbitmq-server</span></div><div class="line">yum -y install rabbitmq-server</div><div class="line"></div><div class="line"><span class="comment">## Automatically start</span></div><div class="line">chkconfig rabbitmq-server on</div><div class="line"></div><div class="line"><span class="comment">## Create a sample config and enable guest user remote access</span></div><div class="line"><span class="built_in">echo</span> &gt; /etc/rabbitmq/rabbitmq.config &lt;&lt;EOF</div><div class="line">[</div><div class="line">  &#123;rabbit, [</div><div class="line">    &#123;loopback_users, []&#125;</div><div class="line">  ]&#125;</div><div class="line">].</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="comment">## Enable magement plugin</span></div><div class="line">/usr/lib/rabbitmq/bin/rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</div><div class="line"></div><div class="line"><span class="comment">## Start rabbitmq-server</span></div><div class="line">service rabbitmq-server start</div><div class="line"></div><div class="line"><span class="comment"># Disable iptables</span></div><div class="line">service iptables stop</div><div class="line">chkconfig iptables off</div></pre></td></tr></table></figure><h2 id="å¯åŠ¨è™šæ‹Ÿæœº"><a href="#å¯åŠ¨è™šæ‹Ÿæœº" class="headerlink" title="å¯åŠ¨è™šæ‹Ÿæœº"></a>å¯åŠ¨è™šæ‹Ÿæœº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vagrant up</div></pre></td></tr></table></figure><h2 id="ä½¿ç”¨SSHè¿æ¥åˆ°è™šæ‹Ÿæœº"><a href="#ä½¿ç”¨SSHè¿æ¥åˆ°è™šæ‹Ÿæœº" class="headerlink" title="ä½¿ç”¨SSHè¿æ¥åˆ°è™šæ‹Ÿæœº"></a>ä½¿ç”¨SSHè¿æ¥åˆ°è™šæ‹Ÿæœº</h2><p>ä½¿ç”¨å‘½ä»¤(å¦‚æœæ”¯æŒçš„è¯):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vagrant ssh</div></pre></td></tr></table></figure><p>æˆ–ä½¿ç”¨SSHå·¥å…·ï¼Œä¾‹å¦‚ <a href="http://www.netsarang.com/products/xsh_overview.html" target="_blank" rel="external">XShell</a>, <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" target="_blank" rel="external">PuTTY</a> ç­‰å·¥å…·ï¼Œè¿æ¥åˆ° <code>10.10.0.70:22</code> (IPåœ¨ä¹‹å‰ <code>Vagrantfile</code> ä¸­å®šä¹‰)</p><h2 id="åœæ­¢è™šæ‹Ÿæœº"><a href="#åœæ­¢è™šæ‹Ÿæœº" class="headerlink" title="åœæ­¢è™šæ‹Ÿæœº"></a>åœæ­¢è™šæ‹Ÿæœº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vagrant halt</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å®‰è£…Vagrant&quot;&gt;&lt;a href=&quot;#å®‰è£…Vagrant&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…Vagrant&quot;&gt;&lt;/a&gt;å®‰è£…Vagrant&lt;/h2&gt;&lt;p&gt;åœ¨&lt;a href=&quot;http://vagrantup.com&quot; target=&quot;_b
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="RabbitMQ" scheme="http://theo.im/tags/rabbitmq/"/>
    
      <category term="Vagrant" scheme="http://theo.im/tags/vagrant/"/>
    
  </entry>
  
  <entry>
    <title>From Octopress To Hexo</title>
    <link href="http://theo.im/blog/2014/05/13/from-octopress-to-hexo/"/>
    <id>http://theo.im/blog/2014/05/13/from-octopress-to-hexo/</id>
    <published>2014-05-13T06:18:50.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>Itâ€™s been a long time, <a href="http://octopress.org/" target="_blank" rel="external">Octopress</a> is slow and painful to setup, after the death of my silly hard drive, Iâ€™m too lazy so I give up setting a Octopress environment, even writing new posts.</p><p>Eventually, Iâ€™m levaing, heading for <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>.</p><h2 id="Whatâ€™s-Hexo"><a href="#Whatâ€™s-Hexo" class="headerlink" title="Whatâ€™s Hexo?"></a>Whatâ€™s Hexo?</h2><p>Hexo is a fast, simple and powerful blog framework. It parses your posts with <a href="http://daringfireball.net/projects/markdown/" target="_blank" rel="external">Markdown</a> or other render engine and generates static files with the beautiful theme. All of these just take seconds.</p><h2 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h2><ul><li>Painless installing</li><li>Cleaner <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a></li><li>Simple configuration</li><li>Fast generating, deploying</li><li>Easy customization</li><li>Actively maintained</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Itâ€™s been a long time, &lt;a href=&quot;http://octopress.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Octopress&lt;/a&gt; is slow and painful to setup, after t
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Hexo" scheme="http://theo.im/tags/hexo/"/>
    
      <category term="GitHub" scheme="http://theo.im/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>åŒè½´å€¾è§’ä¼ æ„Ÿå™¨è®¡ç®—å¡åº¦</title>
    <link href="http://theo.im/blog/2012/12/29/calculating-gradient-form-two-axis-inclinometer/"/>
    <id>http://theo.im/blog/2012/12/29/calculating-gradient-form-two-axis-inclinometer/</id>
    <published>2012-12-29T11:30:00.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¤ $x$ è½´, $y$ è½´ä¸Šçš„è½¬è§’åˆ†åˆ«ä¸º $\alpha, \beta$, å¹³é¢å¡åº¦ä¸º $\theta$, åˆ™:</p><p>$$\begin{align}  \theta = \arccos({    \frac      {1}      {\sqrt{        \tan^2{\alpha} + \tan^2{\beta} + 1      }}  })\end{align}$$</p><p>æœ€è¿‘æ‹¿äº†ä¸ªåŒè½´å€¾è§’ä¼ æ„Ÿå™¨ç©ç©ï¼ŒæŠŠå…¬å¼å’Œç¤ºä¾‹ä»£ç è®°ä¸‹æ¥å¤‡å¿˜ã€‚</p><p>æ¨å¯¼è¿‡ç¨‹å°±çœç•¥äº†ï¼Œä¸‹é¢æ˜¯Cè¯­è¨€æè¿°çš„ç¤ºä¾‹ä»£ç ï¼Œå…¶ä¸­ <code>calc_gradient_from_pitch_roll()</code> å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯<strong>å¼§åº¦</strong>ã€‚</p><figure class="highlight c"><figcaption><span>å¡åº¦è®¡ç®—ç¤ºä¾‹ä»£ç </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MATH_PI     (3.14159f)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEGREES_TO_RADIANS(angle)       ((angle) * ((MATH_PI) / 180.0f))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RADIANS_TO_DEGREES(radians)     ((radians) * (180.0f / (MATH_PI)))</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">float</span> <span class="title">calc_gradient_from_pitch_roll</span><span class="params">(<span class="keyword">float</span> pitch, <span class="keyword">float</span> roll)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">float</span> tan_pitch = <span class="built_in">tan</span>(pitch);</div><div class="line">    <span class="keyword">float</span> tan_roll  = <span class="built_in">tan</span>(roll);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="built_in">acos</span>(<span class="number">1.0f</span> / <span class="built_in">sqrt</span>(tan_pitch * tan_pitch + tan_roll * tan_roll + <span class="number">1.0f</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Test</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        <span class="keyword">float</span> deg_pitch, deg_roll;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"(in degress) pitch,roll = "</span>);</div><div class="line">        <span class="keyword">int</span> ret = <span class="built_in">scanf</span>(<span class="string">"%f,%f"</span>, &amp;deg_pitch, &amp;deg_roll);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (ret == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">float</span> pitch    = DEGREES_TO_RADIANS(deg_pitch);</div><div class="line">            <span class="keyword">float</span> roll     = DEGREES_TO_RADIANS(deg_roll);</div><div class="line">            <span class="keyword">float</span> gradient = calc_gradient_from_pitch_roll(pitch, roll);</div><div class="line"></div><div class="line">            <span class="built_in">printf</span>(<span class="string">"(in degress) gradient = %f\n"</span>, RADIANS_TO_DEGREES(gradient));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ret == EOF) &#123;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// Print error message and clear the input buffer</span></div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Illegal input\n"</span>);</div><div class="line">            setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»¤ $x$ è½´, $y$ è½´ä¸Šçš„è½¬è§’åˆ†åˆ«ä¸º $\alpha, \beta$, å¹³é¢å¡åº¦ä¸º $\theta$, åˆ™:&lt;/p&gt;
&lt;p&gt;$$
\begin{align}
  \theta = \arccos({
    \frac
      {1}
      {\sqrt{

      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Hardware" scheme="http://theo.im/tags/hardware/"/>
    
  </entry>
  
  <entry>
    <title>$\LaTeX$ Support in OmniMarkupPreviewer</title>
    <link href="http://theo.im/blog/2012/11/03/latex-support-in-omnimarkuppreviewer/"/>
    <id>http://theo.im/blog/2012/11/03/latex-support-in-omnimarkuppreviewer/</id>
    <published>2012-11-03T04:41:00.000Z</published>
    <updated>2016-05-21T16:08:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Prologue"><a href="#Prologue" class="headerlink" title="Prologue"></a>Prologue</h2><p>With the release of <a href="http://theo.im/OmniMarkupPreviewer/">OmniMarkupPreviewer</a> <code>v1.6</code>, you can embed $\LaTeX$ and MathML equations directly into your Markdown documents. Equations are handled with the excellent <a href="http://www.mathjax.org/" target="_blank" rel="external">MathJax</a> library.</p><a id="more"></a><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h3><p>In order to enable MathJax, you have to set <code>&quot;mathjax_enabled&quot;</code> to <code>true</code> in your OmniMarkupPreviewer settings. MathJax will be downloaded automatically in the background, so hold on.</p><p><code>OmniMarkupPreviewer.sublime-settings</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"mathjax_enabled"</span>: <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>NOTE (Linux)</strong>For linux users, because ssl module is missing from Linux version of <a href="http://sublimetext.com/2" target="_blank" rel="external">Sublime Text 2</a>, you have to download and extract MathJax library manually:</p><p>Download the MathJax archive:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -c https://github.com/downloads/timonwong/OmniMarkupPreviewer/mathjax.zip</div></pre></td></tr></table></figure><p>Extract to <code>${packages}/OmniMarkupPreviewer/public/</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unzip mathjax.zip <span class="_">-d</span> ~/.config/sublime-text-2/Packages/OmniMarkupPreviewer/public</div></pre></td></tr></table></figure><p>Create an empty file named <code>.MATHJAX.DOWNLOADED</code> in the plugin folder:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch ~/.config/sublime-text-2/Packages/OmniMarkupPreviewer/.MATHJAX.DOWNLOADED</div></pre></td></tr></table></figure><p>After MathJax is installed successfully, you have to <strong>reload</strong> your browser to apply the changes.</p><h3 id="Writing-Equations"><a href="#Writing-Equations" class="headerlink" title="Writing Equations"></a>Writing Equations</h3><h4 id="Inline-Equations"><a href="#Inline-Equations" class="headerlink" title="Inline Equations"></a>Inline Equations</h4><p>Enclose your euqation in <code>$</code> delimiters to include an inline $\LaTeX$ equation, for example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">This expression $\sqrt&#123;3x-1&#125;+(1+x)^2$ is an example of a $\LaTeX$ inline equation.</div></pre></td></tr></table></figure><p>This expression $\sqrt{3x-1}+(1+x)^2$ is an example of a $\LaTeX$ inline equation.</p><p>Alternatively, native MathJax delimiter for inline math (<code>\(</code> and <code>\)</code>) is also supported.</p><h4 id="Display-Equations"><a href="#Display-Equations" class="headerlink" title="Display Equations"></a>Display Equations</h4><p>To include a $\LaTeX$ display equation you have to enclose the equation in <code>$$</code> delimiters, for example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">The Lorenz Equations:</div><div class="line"></div><div class="line">$$</div><div class="line">\begin&#123;aligned&#125;</div><div class="line">\dot&#123;x&#125; &amp; = \sigma(y-x) \\</div><div class="line">\dot&#123;y&#125; &amp; = \rho x - y - xz \\</div><div class="line">\dot&#123;z&#125; &amp; = -\beta z + xy</div><div class="line">\end&#123;aligned&#125;</div><div class="line">$$</div></pre></td></tr></table></figure>$$\begin{aligned}\dot{x} & = \sigma(y-x) \\\dot{y} & = \rho x - y - xz \\\dot{z} & = -\beta z + xy\end{aligned}$$<p>The alternative syntax of native MathJax delimiter for display math (<code>\[</code> and <code>\]</code>) is also provided.</p><h4 id="MathML-Equations"><a href="#MathML-Equations" class="headerlink" title="MathML Equations"></a>MathML Equations</h4><p>You can alsow insert MathML euqations, just wrap your equation inside the standard <code>&lt;math&gt;</code> tag:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">math</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1998/Math/MathML"</span> <span class="attr">display</span>=<span class="string">"block"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mi</span>&gt;</span>P<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mo</span> <span class="attr">stretchy</span>=<span class="string">"false"</span>&gt;</span>(<span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mi</span>&gt;</span>E<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mo</span> <span class="attr">stretchy</span>=<span class="string">"false"</span>&gt;</span>)<span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mo</span>&gt;</span>=<span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mrow</span> <span class="attr">class</span>=<span class="string">"MJX-TeXAtom-ORD"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mfenced</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mfrac</span> <span class="attr">linethickness</span>=<span class="string">"0"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mi</span>&gt;</span>n<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mi</span>&gt;</span>k<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">mfrac</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mfenced</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">mrow</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">msup</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mi</span>&gt;</span>p<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mi</span>&gt;</span>k<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">msup</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mo</span> <span class="attr">stretchy</span>=<span class="string">"false"</span>&gt;</span>(<span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mn</span>&gt;</span>1<span class="tag">&lt;/<span class="name">mn</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mo</span>&gt;</span>&amp;#x2212;<span class="comment">&lt;!-- âˆ’ --&gt;</span><span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mi</span>&gt;</span>p<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">msup</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mo</span> <span class="attr">stretchy</span>=<span class="string">"false"</span>&gt;</span>)<span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mrow</span> <span class="attr">class</span>=<span class="string">"MJX-TeXAtom-ORD"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mi</span>&gt;</span>n<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mo</span>&gt;</span>&amp;#x2212;<span class="comment">&lt;!-- âˆ’ --&gt;</span><span class="tag">&lt;/<span class="name">mo</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">mi</span>&gt;</span>k<span class="tag">&lt;/<span class="name">mi</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mrow</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">msup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">math</span>&gt;</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Prologue&quot;&gt;&lt;a href=&quot;#Prologue&quot; class=&quot;headerlink&quot; title=&quot;Prologue&quot;&gt;&lt;/a&gt;Prologue&lt;/h2&gt;&lt;p&gt;With the release of &lt;a href=&quot;http://theo.im/OmniMarkupPreviewer/&quot;&gt;OmniMarkupPreviewer&lt;/a&gt; &lt;code&gt;v1.6&lt;/code&gt;, you can embed $\LaTeX$ and MathML equations directly into your Markdown documents. Equations are handled with the excellent &lt;a href=&quot;http://www.mathjax.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MathJax&lt;/a&gt; library.&lt;/p&gt;
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Sublime Text 2" scheme="http://theo.im/tags/sublime-text-2/"/>
    
      <category term="Sublime Text 3" scheme="http://theo.im/tags/sublime-text-3/"/>
    
      <category term="OmniMarkupPreviewer" scheme="http://theo.im/tags/omnimarkuppreviewer/"/>
    
  </entry>
  
  <entry>
    <title>Directory comparison for git difftool, with Beyond Compare 3</title>
    <link href="http://theo.im/blog/2012/10/27/directory-comparison-for-git-difftool/"/>
    <id>http://theo.im/blog/2012/10/27/directory-comparison-for-git-difftool/</id>
    <published>2012-10-27T15:02:00.000Z</published>
    <updated>2016-05-21T15:40:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>For a long time, I didnâ€™t know a way to do directory comparison using git difftool command, <a href="http://mercurial.selenic.com/wiki/ExtdiffExtension" target="_blank" rel="external">extdiff extension</a> from Mercurial did perform much more superior than Git.</p><p>Though it may be a bit out of date, I just found that after <code>v1.7.11</code>, Git now supports directory comparison through <code>--dir-diff</code> option, fantastic!</p><p><strong>UPDATE 12/11/2012:</strong> You will need v1.8.0 version of <a href="http://code.google.com/p/msysgit/downloads/list" target="_blank" rel="external">msysgit</a> installed, as noted by <strong>Scooter Software</strong> (<a href="http://www.scootersoftware.com/vbulletin/showthread.php?t=9449" target="_blank" rel="external">Reference</a>).</p><p>So here is a list of steps for me to make Beyond Compare 3 and Git directory comparison work under Windows.</p><p>First of all, Execute following commands in the <code>Git Bash</code> shell (or just modify your .gitconfig directly). You may need to change the folder where <code>BCompare.exe</code> resides.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git config --global diff.tool bc3</div><div class="line">git config --global difftool.bc3.cmd &quot;\&quot;c:/Program Files/Beyond Compare 3/BCompare.exe\&quot; \&quot;$LOCAL\&quot; \&quot;$REMOTE\&quot;&quot;</div><div class="line">git config --global difftool.prompt false</div></pre></td></tr></table></figure><p><strong>NOTE:</strong> Instead of <code>bcomp.exe</code>, use <code>BCompare.exe</code>, because Iâ€™ve found <code>bcomp.exe</code> returns too early, which will cause errors like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">...Git/libexec/git-core\git-difftool line 444: Bad file number</div></pre></td></tr></table></figure><p>Then make an alias for difftool:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --global alias.dt &quot;difftool --dir-diff&quot;</div></pre></td></tr></table></figure><p>Now, you can use <code>git dt</code> to open Beyond Compare 3 for directory comparison in git repositories.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;For a long time, I didnâ€™t know a way to do directory comparison using git difftool command, &lt;a href=&quot;http://mercurial.selenic.com/wiki/Ex
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Git" scheme="http://theo.im/tags/git/"/>
    
      <category term="Beyond Compare 3" scheme="http://theo.im/tags/beyond-compare-3/"/>
    
  </entry>
  
  <entry>
    <title>Workaround: Failed to import unicodedata in Sublime Text 2 under Windows</title>
    <link href="http://theo.im/blog/2012/10/25/workaround-failed-to-import-unicodedata-in-sublime-text-2-under-windows/"/>
    <id>http://theo.im/blog/2012/10/25/workaround-failed-to-import-unicodedata-in-sublime-text-2-under-windows/</id>
    <published>2012-10-25T05:36:00.000Z</published>
    <updated>2017-10-14T15:53:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>Itâ€™s weird, while importing some .pyd modules, like pyexpat, unicodedata in Windows version of <a href="http://www.sublimetext.com/2" target="_blank" rel="external">Sublime Text 2</a>, you will get <code>ImportError</code>, for example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> unicodedata</div></pre></td></tr></table></figure><p>Will result in:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Import Error: No module named unicodedata</div></pre></td></tr></table></figure><p>However, since standard pyd modules are not missing, reside correctly in the same folder as sublime_text.exe, we can add that folder to sys.path in order to allow embedded python interpreter to load these modules:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sys.path.insert(os.path.dirname(sys.executable))</div></pre></td></tr></table></figure><p>After that, you can import these standard python modules without pain, I hope itâ€™s useful for Sublime Text 2 packages developers who met the same problem before.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Itâ€™s weird, while importing some .pyd modules, like pyexpat, unicodedata in Windows version of &lt;a href=&quot;http://www.sublimetext.com/2&quot; tar
      
    
    </summary>
    
      <category term="IT" scheme="http://theo.im/blog/categories/it/"/>
    
    
      <category term="Sublime Text 2" scheme="http://theo.im/tags/sublime-text-2/"/>
    
      <category term="Python" scheme="http://theo.im/tags/python/"/>
    
  </entry>
  
</feed>
